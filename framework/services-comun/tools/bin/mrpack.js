#!/usr/bin/env node
(()=>{"use strict";var e={618:(e,o,r)=>{var t=r(81),s=t.spawn,i=t.exec;function a(e,o,r){var t={};try{Object.keys(e).forEach((function(r){e[r].forEach((function(e){t[e]||(n(e,o),t[e]=1)})),t[r]||(n(r,o),t[r]=1)}))}catch(e){if(r)return r(e);throw e}if(r)return r()}function n(e,o){try{process.kill(parseInt(e,10),o)}catch(e){if("ESRCH"!==e.code)throw e}}function l(e,o,r,t,s){var i=t(e),a="";i.stdout.on("data",(function(e){e=e.toString("ascii"),a+=e})),i.on("close",(function(i){delete r[e],0==i?a.match(/\d+/g).forEach((function(i){i=parseInt(i,10),o[e].push(i),o[i]=[],r[i]=1,l(i,o,r,t,s)})):0==Object.keys(r).length&&s()}))}e.exports=function(e,o,r){if("function"==typeof o&&void 0===r&&(r=o,o=void 0),e=parseInt(e),Number.isNaN(e)){if(r)return r(new Error("pid must be a number"));throw new Error("pid must be a number")}var t={},n={};switch(t[e]=[],n[e]=1,process.platform){case"win32":i("taskkill /pid "+e+" /T /F",r);break;case"darwin":l(e,t,n,(function(e){return s("pgrep",["-P",e])}),(function(){a(t,o,r)}));break;default:l(e,t,n,(function(e){return s("ps",["-o","pid","--no-headers","--ppid",e])}),(function(){a(t,o,r)}))}}},575:(e,o)=>{var r;Object.defineProperty(o,"__esModule",{value:!0}),o.Fecha=o.TTimeUnit=void 0,function(e){e.DAY="d",e.HOUR="h",e.MINUTE="m",e.SECOND="s",e.MILLISECOND="ms"}(r||(o.TTimeUnit=r={}));class t{static MESES=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];static SEMANA=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];static generarFechaMySQL(e){return[e.getUTCFullYear(),`00${e.getUTCMonth()+1}`.slice(-2),`00${e.getUTCDate()}`.slice(-2)].join("-")}static generarFechaElastic(e,o={}){const r=[];return(o={anno:!0,mes:!0,dia:!0,...o}).anno&&r.push(`${e.getUTCFullYear()}`),o.mes&&r.push(`00${e.getUTCMonth()+1}`.slice(-2)),o.dia&&r.push(`00${e.getUTCDate()}`.slice(-2)),r.length>0?r.join("."):""}static generarFechaNatural(e){return[`00${e.getUTCDate()}`.slice(-2),`00${e.getUTCMonth()+1}`.slice(-2),e.getUTCFullYear()].join("/")}static generarFechaNaturalConDiaSemana(e){return`${t.SEMANA[e.getUTCDay()-1>=0?e.getUTCDay()-1:t.SEMANA.length-1]}, `+[`00${e.getUTCDate()}`.slice(-2),`00${e.getUTCMonth()+1}`.slice(-2),e.getUTCFullYear()].join("/")}static generarFechaBloque(e){return[e.getUTCFullYear(),`00${e.getUTCMonth()+1}`.slice(-2),`00${e.getUTCDate()}`.slice(-2)].join("")}static generarHora(e,o=!0){return[`00${e.getUTCHours()}`.slice(-2),`00${e.getUTCMinutes()}`.slice(-2),`00${e.getUTCSeconds()}`.slice(-2)].join(":")+(o?" UTC":"")}static generarHoraMinuto(e,o=!0){return[`00${e.getUTCHours()}`.slice(-2),`00${e.getUTCMinutes()}`.slice(-2)].join(":")+(o?" UTC":"")}static generarMarcaMinuto(e){return[e.getUTCFullYear(),`00${e.getUTCMonth()+1}`.slice(-2),`00${e.getUTCDate()}`.slice(-2),`00${e.getUTCHours()}`.slice(-2),`00${e.getUTCMinutes()}`.slice(-2)].join("")}static generarMarcaMes(e=new Date){return[e.getUTCFullYear(),`00${e.getUTCMonth()+1}`.slice(-2)].join("")}static generarFechaHoraMySQL(e){return`${t.generarFechaMySQL(e)} ${t.generarHora(e,!1)}`}static generarFechaHoraNatural(e,o=!0){return`${t.generarFechaNatural(e)} ${t.generarHoraMinuto(e,o)}`}static generarFechaHoraNaturalConDiaSemana(e,o=!0){return`${t.generarFechaNaturalConDiaSemana(e)} ${t.generarHoraMinuto(e,o)}`}static generarIntervaloFechasNatural(e,o){return e.getDate()==o.getDate()&&e.getMonth()==o.getMonth()&&e.getFullYear()==o.getFullYear()?`${e.getDate()} ${this.MESES[e.getMonth()]}`:`${e.getDate()}${e.getMonth()!=o.getMonth()?` ${this.MESES[e.getMonth()]}`:""} - ${o.getDate()} ${this.MESES[o.getMonth()]}`}static generarDateDesdeMySQL(e){const o=e.split(/[- :]/).map((e=>parseInt(e)));return new Date(Date.UTC(o[0],o[1]-1,o[2],o[3]||0,o[4]||0,o[5]||0))}static ignoraTZ(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))}static generarLog(){return`[${this.generarFechaHoraNatural(new Date,!1)}]`}static determineDiffTime(e){const o={time:e,unit:r.MILLISECOND};return e>864e5?(o.time=parseFloat((e/864e5).toFixed(2)),o.unit=r.DAY):e>36e5?(o.time=parseFloat((e/36e5).toFixed(2)),o.unit=r.HOUR):e>6e4?(o.time=parseFloat((e/6e4).toFixed(2)),o.unit=r.MINUTE):e>1e3&&(o.time=parseFloat((e/1e3).toFixed(2)),o.unit=r.SECOND),o}}o.Fecha=t},823:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.freeSpace=o.md5Dir=o.findSubdirs=o.unlink=o.safeWriteStreamBuffer=o.safeWriteStream=o.safeWrite=o.overwrite=o.rmDirManual=o.rmdir=o.rename=o.mkdir=o.isFile=o.isDir=o.readJSONSync=o.readJSON=o.fileSize=o.readFileString=o.readFileBuffer=o.stats=o.readFile=o.readDir=o.exists=void 0;const t=r(732),s=t.__importDefault(r(561)),i=t.__importDefault(r(411)),a=r(561),n=r(977);Object.defineProperty(o,"readDir",{enumerable:!0,get:function(){return n.readdir}}),Object.defineProperty(o,"readFile",{enumerable:!0,get:function(){return n.readFile}}),Object.defineProperty(o,"stats",{enumerable:!0,get:function(){return n.stat}});const l=r(928),c=r(617),u=r(885),d=r(328);async function p(e){return new Promise((o=>{s.default.access(e,s.default.constants.F_OK,(e=>{o(!e)}))}))}async function g(e){return(await(0,n.readFile)(e)).toString("utf-8")}async function h(e,o=!1){try{if((await(0,n.stat)(e)).isDirectory())return!0}catch(e){}return!!o&&Promise.reject("Not a directory")}async function f(e,o=!1){try{if((await(0,n.stat)(e)).isFile())return!0}catch(e){}return!!o&&Promise.reject("Not a file")}async function m(e,o){return(0,n.rename)(e,o).then((()=>!0)).catch((()=>!1))}async function w(e){await(0,n.rm)(e,{recursive:!0,force:!0})}async function y(e,o,r){return!r&&await p(o)?(await $(e),!1):(await m(e,o)||await $(e),!0)}async function C(e,o,r=!1,t=!1){const i=`${e}.${(0,d.random)()}`;return new Promise(((a,n)=>{s.default.writeFile(i,o,{flag:"wx"},(o=>{o?t?n("No se pudo escribir archivo temporal"):((0,l.error)("Error en safeWrite",i,o),a(!1)):y(i,e,r).then((e=>{e?a(!0):t?n("No se pudo renombrar el archivo temporal al final"):a(!1)}))}))}))}async function $(e){await f(e)?await new Promise(((o,r)=>{s.default.unlink(e,(e=>{e?r(e):o()}))})):await h(e)&&await w(e)}o.exists=p,o.readFileBuffer=async function(e){return(0,n.readFile)(e)},o.readFileString=g,o.fileSize=async function(e){return(await(0,n.stat)(e)).size},o.readJSON=async function(e){try{const o=await g(e);return JSON.parse(o)}catch(e){return Promise.reject(e)}},o.readJSONSync=function(e){try{return JSON.parse((0,a.readFileSync)(e).toString("utf-8"))}catch(e){return null}},o.isDir=h,o.isFile=f,o.mkdir=async function(e,o=!1){await(0,n.mkdir)(e,{recursive:o})},o.rename=m,o.rmdir=w,o.rmDirManual=async function e(o){if(await h(o))for(const r of await(0,n.readdir)(o))await e(`${o}/${r}`);await $(o)},o.overwrite=y,o.safeWrite=C,o.safeWriteStream=async function(e,o,r=!1){const t=`${o}.${(0,d.random)()}`;return(0,u.pipeline)(e,s.default.createWriteStream(t,{flags:"wx"})).then((async()=>y(t,o,r))).catch((async e=>(await(0,l.warning)(`Error escribiendo temporal ${t}`,e),await f(t)&&await $(t),!1)))},o.safeWriteStreamBuffer=async function(e,o,r=!1){const t=[];return e.on("data",(e=>{t.push(e)})),new Promise((s=>{e.on("end",(()=>{C(o,Buffer.concat(t),r).then((()=>{s()})).catch((()=>{s()}))})),e.on("error",(()=>{s()}))}))},o.unlink=$,o.findSubdirs=async function e(o){const r=[];if(await h(o)){r.push(o);for(const t of await(0,n.readdir)(o))[".",".."].includes(t)||r.push(...await e(`${o}/${t}`))}return r},o.md5Dir=async function e(o){if(!await f(o)&&!await h(o))return"";const r=await async function(o){const r=[(0,c.md5)(i.default.basename(o))];if(await f(o))r.push((0,c.md5)(await g(o)));else if(await h(o))for(const t of await(0,n.readdir)(o)){const s=`${o}/${t}`;await h(s)?"files"!=s&&r.push(await e(s)):await f(s)&&(r.push((0,c.md5)(t)),r.push((0,c.md5)(await g(s))))}return r.join("")}(o);return 32!=r.length?(0,c.md5)(r):r},o.freeSpace=async function(e){return new Promise(((o,r)=>{s.default.statfs(e,((e,t)=>{e?r(e):o(t.bsize*t.bavail)}))}))}},617:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.md5=void 0;const t=r(5);o.md5=function(e){return(0,t.createHash)("md5").update(e).digest("hex")}},928:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.formatTiempo=o.formatMemoria=o.timeEnd=o.time=o.debug=o.error=o.warning=o.info=void 0;const t=r(732),s=t.__importDefault(r(612)),i=t.__importDefault(r(878)),a="true"==process.env.KUBERNETES,n=function(){const e=i.default.worker?.id;if(a){const o=s.default.hostname().split("-"),r=o.pop();return o.pop(),null==e?`[${o.join("-")} ${r}]`:`[${o.join("-")} ${r} {${e}}]`}return null==e?"":` {${e}}`}();function l(...e){e.length>0?console.info(n,...e):a||console.info("")}o.info=l,o.warning=function(...e){e.length>0?console.warn(n,...e):a||console.warn("")},o.error=function(...e){e.length>0?console.error(n,...e):a||console.error("")},o.debug=function(...e){e.length>0?console.debug(n,...e):a||console.debug("")},o.time=function(e,o=""){o.length>0&&l(o),console.time(`${a?"":"                      "}=> ${e}`)},o.timeEnd=function(e){l("Fin de proceso: "),console.timeEnd(`${a?"":"                      "}=> ${e}`)},o.formatMemoria=function(e){let o="B";return Math.abs(e)>1024&&(e/=1024,o="KB"),Math.abs(e)>1024&&(e/=1024,o="MB"),Math.abs(e)>1024&&(e/=1024,o="GB"),Math.abs(e)>1024&&(e/=1024,o="TB"),`${e.toFixed(2)}${o}`},o.formatTiempo=function(e){let o=0,r=0,t=0,s=0,i=0,a=0;(e=Math.floor(e))>1e3&&(a=Math.floor(e/1e3),e%=1e3),a>60&&(i=Math.floor(a/60),a%=60),i>60&&(s=Math.floor(i/60),i%=60),s>24&&(t=Math.floor(s/24),s%=24),t>365&&(o=Math.floor(t/365),t%=365),t>30&&(r=Math.floor(t/30),t%=30);const n=[];if(o>0&&n.push(`${o} año${1==o?"":"s"}`),r>0&&n.push(`${r} mes${1==r?"":"es"}`),t>0&&n.push(`${t} dia${1==t?"":"s"}`),s>0&&n.push(`${s} hora${1==s?"":"s"}`),i>0&&n.push(`${i} minuto${1==i?"":"s"}`),a>0&&n.push(`${a} segundo${1==a?"":"s"}`),e>0&&n.push(`${e} milisegundo${1==e?"":"s"}`),n.length>0){const e=n.pop();return n.length>0?`${n.join(", ")} y ${e}`:e}return"0 milisegundos"}},173:(e,o)=>{async function r(e=0){return new Promise((o=>{setTimeout((()=>{o()}),e)}))}Object.defineProperty(o,"__esModule",{value:!0}),o.PromiseMap=o.PromiseResult=o.PromiseAny=o.PromiseTimeout=o.PromiseTimeoutError=o.PromiseChain=o.PromiseDelayed=void 0,o.PromiseDelayed=r,o.PromiseChain=async function(e,o){const r=[];for(let t of e){const e=await o(t);r.push(e)}return r};class t extends Error{ms;constructor(e){super("Timed out"),this.ms=e}}async function s(e){return e.then((e=>({status:"OK",result:e}))).catch((e=>({status:"KO",error:e})))}o.PromiseTimeoutError=t,o.PromiseTimeout=async function(e,o){return await Promise.race([e,r(o).then((()=>Promise.reject(new t(o))))])},o.PromiseAny=async function(e){return await Promise.all(e.map((e=>s(e))))},o.PromiseResult=s,o.PromiseMap=function(e,o){const r=[];for(const t of e)r.push(o(t));return r}},328:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.valoresValidos=o.random=void 0,o.random=function(e=8){let o="";for(let r=0;r<e;r++)o+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(Math.round(62*Math.random()));return o},o.valoresValidos=function(e){if(e.length<3)return[];const o=e.reduce(((e,o)=>o<e?o:e)),r=e.reduce(((e,o)=>o>e?o:e));if(Math.abs(o-r)<1)return e;const t=[],s=[];let i=!1;for(let a of e){const e=Math.abs(a-o),n=Math.abs(a-r);e<n?t.push(a):(e>n||(i=!0,t.push(a)),s.push(a))}return i||(1==t.length&&e.splice(e.indexOf(t[0]),1),1==s.length&&e.splice(e.indexOf(s[0]),1)),e}},885:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.stream2buffer=o.buffer2stream=o.pipeline=void 0;const t=r(492),s=(0,r(261).promisify)(t.pipeline);o.pipeline=s,o.buffer2stream=function(e){return new t.Readable({read(){this.push(e),this.push(null)}})},o.stream2buffer=async function(e){return new Promise((o=>{const r=[];e.on("data",(e=>{r.push(e)})).on("end",(()=>{o(Buffer.concat(r))}))}))}},24:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Colors=void 0;class r{static Reset="[0m";static Bright="[1m";static Dim="[2m";static Underscore="[4m";static Blink="[5m";static Reverse="[7m";static Hidden="[8m";static FgBlack="[30m";static FgRed="[31m";static FgGreen="[32m";static FgYellow="[33m";static FgBlue="[34m";static FgMagenta="[35m";static FgCyan="[36m";static FgWhite="[37m";static BgBlack="[40m";static BgRed="[41m";static BgGreen="[42m";static BgYellow="[43m";static BgBlue="[44m";static BgMagenta="[45m";static BgCyan="[46m";static BgWhite="[47m";static COLORS=[[r.FgCyan,r.Bright],[r.FgGreen,r.Bright],[r.FgMagenta,r.Bright],[r.FgYellow,r.Bright],[r.FgRed,r.Bright],[r.FgWhite,r.Bright],[r.FgBlue,r.Bright],[r.FgCyan],[r.FgGreen],[r.FgMagenta],[r.FgYellow],[r.FgRed],[r.FgWhite],[r.FgBlue],[r.FgCyan,r.Dim],[r.FgGreen,r.Dim],[r.FgMagenta,r.Dim],[r.FgYellow,r.Dim],[r.FgRed,r.Dim],[r.FgWhite,r.Dim],[r.FgBlue,r.Dim]];static I=0;static nextColor(){const e=this.COLORS[this.I];return this.I=(this.I+1)%this.COLORS.length,e}static resetNext(){this.I=0}static colorize(e,o){return`${e.join("")}${o}${this.Reset}`}}o.Colors=r},954:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Comando=void 0;const t=r(718);o.Comando=class{static async spawn(e,o=[],{cwd:r}={}){const s=(0,t.spawn)(e,o,{cwd:r,env:{...process.env,FORCE_COLOR:"1"},stdio:"pipe",shell:!0}),i=[];s.stdout.on("data",(e=>{i.push(e.toString("utf-8"))}));const a=[];return s.stderr.on("data",(e=>{a.push(e.toString("utf-8"))})),new Promise((e=>{s.on("close",(o=>{e({status:o??0,stdout:i.join(""),stderr:a.join("")})}))}))}}},654:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Deploy=void 0;const t=r(437),s=r(173),i=r(823);o.Deploy=class{static run(e,o){(0,s.PromiseDelayed)().then((async()=>{const r=await(0,i.readDir)(`${e}/services/`),s=(await Promise.all(r.map((o=>t.Compilar.build(e,o))))).filter((e=>null!=e));s.forEach((e=>{e.checkDependencias(s)})),await Promise.all([t.Compilar.md5Deps(e),...s.map((e=>e.pack(o)))])})).catch((e=>{null!=e&&console.error(e),process.exit(1)}))}}},449:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Devel=void 0;const t=r(561),s=r(401),i=r(642),a=r(433),n=r(131),l=r(162),c=r(173),u=r(823);o.Devel=class{static run(e,o){(0,c.PromiseDelayed)().then((async()=>{o.compilar&&[await a.Init.init(e),await s.Framework.update(e)].reduce(((e,o)=>e||o),!1)&&await l.Yarn.install(e,{verbose:!1}),await this.ejecutar(o,e)})).catch((e=>{null!=e&&console.error(e)}))}static async ejecutar(e,o){const[r,t,s]=await Promise.all([this.ejecutarWorkspace(o,"framework"),this.ejecutarWorkspace(o,"packages"),this.ejecutarWorkspace(o,"statics")]);await this.ejecutarServices(e,o,[...r,...t,...s])}static async ejecutarWorkspace(e,o){if(!await(0,u.isDir)(`${e}/${o}`))return[];const r=await(0,u.readDir)(`${e}/${o}`),t=[];for(const s of r){const r=new n.Workspace({nombre:s,path:o,root:e});t.push(r.init().then((()=>r)))}return await Promise.all(t)}static async ejecutarServices(e,o,r){const s=await(0,u.readJSON)(`${o}/config.workspaces.json`).catch((()=>({devel:{available:[],disabled:[]},packd:{available:[],disabled:[]},services:{}}))),a=await(0,u.readDir)(`${o}/services`),n=a.reduce(((e,o)=>Math.max(e,o.length)),0),l=[];for(const t of a){const a=new i.Service({nombre:t,path:"services",root:o,pad:n,compilar:e.compilar,ejecutar:e.ejecutar,forzar:e.forzar,global:s});l.push(a.init().then((()=>{for(const e of r)e.addHijo(a);return a})))}const c=await Promise.all(l);(0,t.watch)(`${o}/config.workspaces.json`,(()=>{(0,u.readJSON)(`${o}/config.workspaces.json`).catch((()=>({devel:{available:[],disabled:[]},packd:{available:[],disabled:[]},services:{}}))).then((async e=>{for(const o of c)o.updateGlobal(e)}))}))}}},401:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Framework=void 0;const t=r(732),s=r(5),i=t.__importDefault(r(411)),a=r(24),n=r(954),l=r(823),c=r(823),u=r(162);o.Framework=class{static async add(e,o){console.log(a.Colors.colorize([a.Colors.FgCyan,a.Colors.Bright],"Añadiendo frameworks")),console.group(),await(0,c.mkdir)(`${e}/tmp`,!0);const r=[];for(const t of o)r.push(this.download(t,`${e}/framework/${t}`));const t=await Promise.all(r).catch((e=>(console.groupEnd(),Promise.reject(e))));return console.groupEnd(),!!t.reduce(((e,o)=>e||o),!1)&&(await u.Yarn.install(e,{verbose:!1}),!0)}static async remove(e,o){console.log(a.Colors.colorize([a.Colors.FgCyan,a.Colors.Bright],"Eliminando frameworks")),console.group(),await(0,c.mkdir)(`${e}/tmp`,!0);const r=[];for(const t of o.filter((e=>"services-comun"!=e)))await(0,l.isDir)(`${e}/framework/${t}`)&&(console.log(a.Colors.colorize([a.Colors.FgMagenta],t),"=> Eliminando"),r.push((0,c.unlink)(`${e}/framework/${t}`).then((()=>(console.log(a.Colors.colorize([a.Colors.FgMagenta],t),`=> Eliminando [${a.Colors.colorize([a.Colors.FgGreen,a.Colors.Bright],"OK   ")}]`),!0))).catch((e=>(console.log(a.Colors.colorize([a.Colors.FgMagenta],t),`=> Eliminando [${a.Colors.colorize([a.Colors.FgRed,a.Colors.Bright],"ERROR")}]`),Promise.reject(e))))));const t=await Promise.all(r).catch((e=>(console.groupEnd(),Promise.reject(e))));return console.groupEnd(),!!t.reduce(((e,o)=>e||o),!1)&&(await u.Yarn.install(e,{verbose:!1}),!0)}static async update(e){console.log(a.Colors.colorize([a.Colors.FgCyan,a.Colors.Bright],"Comprobando frameworks")),console.group(),await(0,c.mkdir)(`${e}/tmp`,!0);const o=[];for(const r of await(0,l.readDir)(`${e}/framework`))o.push(this.download(r,`${e}/framework/${r}`));const r=await Promise.all(o).catch((e=>(console.groupEnd(),Promise.reject(e))));return console.groupEnd(),r.reduce(((e,o)=>e||o),!1)}static async push(e){console.log(a.Colors.colorize([a.Colors.FgCyan,a.Colors.Bright],"Enviando frameworks")),console.group();const o=`${e}/tmp`;await(0,c.mkdir)(o,!0);for(const e of await(0,l.readDir)(o))await(0,c.unlink)(`${o}/${e}`);const r=[];for(const t of await(0,l.readDir)(`${e}/framework`))r.push(this.upload(t,`${e}/framework/${t}`,`${o}/${t}`));const t=await Promise.all(r).catch((e=>(console.groupEnd(),Promise.reject(e))));return console.groupEnd(),t.reduce(((e,o)=>e||o),!1)}static dateVersion(e){const[o,r]=e.split("+"),t=new Date(o);return t.setUTCMinutes(parseInt(r)),t.getTime()}static async parseDir(e){const o=[];if(await(0,l.isDir)(e)){for(const r of await(0,l.readDir)(e)){const t=e+"/"+r;await(0,l.isDir)(t)?o.push(await this.parseDir(t)):await(0,l.isFile)(t)&&o.push((0,s.createHash)("md5").update(await(0,l.readFileString)(t)).digest("hex"))}return o.join("")}return await(0,l.isFile)(e)?(0,s.createHash)("md5").update(await(0,l.readFileString)(e)).digest("hex"):""}static async upload(e,o,r){const t=await(0,l.readJSON)(`${o}/package.json`),i=t.version??"2022.1.1+0",u=this.dateVersion(i),d=t.hash??"",{status:p,stdout:g}=await n.Comando.spawn("gsutil",["cat",`gs://meteored-yarn-workspaces/${e}/package.json`]);if(0==p){const o=JSON.parse(g);if(this.dateVersion(o.version??"0000.00.00+0")>u)return console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Existe una nueva versión para descargar ${a.Colors.colorize([a.Colors.FgBlue],i)} => ${a.Colors.colorize([a.Colors.FgGreen],o.version)} [${a.Colors.colorize([a.Colors.FgRed,a.Colors.Bright],"ERROR")}]`),!1}delete t.version,delete t.hash,await(0,l.safeWrite)(`${o}/package.json`,JSON.stringify(t,null,2),!0),await(0,c.mkdir)(r,!0),await(0,l.isDir)(`${o}/files`)&&await(0,c.rename)(`${o}/files`,`${r}/files`);const h=(0,s.createHash)("md5").update(await this.parseDir(`${o}/`)).digest("hex");if(h!==d){const r=/^(\d{4}\.\d{1,2}\.\d{1,2})\+(\d+)$/.exec(i);let s,l;null==r?(s="2022.1.1",l="1"):(s=r[1],l=r[2]);const c=new Date,u=[c.getUTCFullYear(),c.getUTCMonth()+1,c.getUTCDate()].join(".");let d;d=s===u?parseInt(l)+1:1,await this.updatePackage(o,t,`${u}+${d}`,h),console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Subiendo nueva versión ${a.Colors.colorize([a.Colors.FgBlue],i)} => ${a.Colors.colorize([a.Colors.FgGreen],t.version)}`),await n.Comando.spawn("gsutil",["-o",'"GSUtil:parallel_process_count=1"',"-m","rm","-r",`gs://meteored-yarn-workspaces/${e}`]),await n.Comando.spawn("gsutil",["-o",'"GSUtil:parallel_process_count=1"',"-m","cp","-r",o,"gs://meteored-yarn-workspaces/"]),console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Subiendo nueva versión ${a.Colors.colorize([a.Colors.FgBlue],i)} => ${a.Colors.colorize([a.Colors.FgGreen],t.version)} [${a.Colors.colorize([a.Colors.FgGreen,a.Colors.Bright],"OK   ")}]`)}else await this.updatePackage(o,t,i,d),p>0?(console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Subiendo versión ${a.Colors.colorize([a.Colors.FgBlue],i)}`),await n.Comando.spawn("gsutil",["-o",'"GSUtil:parallel_process_count=1"',"-m","cp","-r",o,"gs://meteored-yarn-workspaces/"]),console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Subiendo versión ${a.Colors.colorize([a.Colors.FgBlue],i)} [${a.Colors.colorize([a.Colors.FgGreen,a.Colors.Bright],"OK   ")}]`)):console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> ${a.Colors.colorize([a.Colors.FgBlue],"Nada que subir")}`);return await(0,l.isDir)(`${r}/files`)&&await(0,c.rename)(`${r}/files`,`${o}/files`),await(0,l.rmdir)(r),!0}static async updatePackage(e,o,r,t){o.version=r,o.hash=t,await(0,l.safeWrite)(`${e}/package.json`,`${JSON.stringify(o,null,2)}\n`,!0)}static async download(e,o){const r=await(0,l.isFile)(`${o}/package.json`),t=r?await(0,l.readJSON)(`${o}/package.json`):{version:"0000.0.0+0"},s=t.version??"0000.0.0+0",u=this.dateVersion(s);let d=t;{const{status:o,stdout:t,stderr:i}=await n.Comando.spawn("gsutil",["cat",`gs://meteored-yarn-workspaces/${e}/package.json`]);if(0!=o)return console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> [${a.Colors.colorize([a.Colors.FgRed,a.Colors.Bright],"ERROR")}]`),console.log(a.Colors.colorize([a.Colors.FgMagenta],e),"=>",i),Promise.reject();if(d=JSON.parse(t),u>=this.dateVersion(d.version))return console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Actualizado ${a.Colors.colorize([a.Colors.FgBlue],s)}`),!1;r?console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Nueva versión ${a.Colors.colorize([a.Colors.FgBlue],s)} => ${a.Colors.colorize([a.Colors.FgGreen],d.version)}`):console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Instalando ${a.Colors.colorize([a.Colors.FgGreen],d.version)}`)}if(r){const{status:r,stdout:t,stderr:i}=await n.Comando.spawn("git",["diff","--name-only",o]);if(0!=r)return console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> ${a.Colors.colorize([a.Colors.FgRed],"Error comprobando cambios locales")}`),console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> ${i}`),Promise.reject();const l=t.trim();if(l.length>0)return await this.downloadError(e,s,d.version,l.split("\n"))}const p=i.default.resolve(o,"../../tmp");await Promise.all([this.clearTMP(`${p}/${e}`),this.clearTMP(`${p}/${e}-old`)]);const{status:g,stderr:h}=await n.Comando.spawn("gsutil",["-o",'"GSUtil:parallel_process_count=1"',"-m","cp","-r",`gs://meteored-yarn-workspaces/${e}`,p]);return 0!=g?await this.downloadError(e,s,d.version,h.split("\n")):r&&(await(0,l.isDir)(`${o}/files`)&&await(0,c.rename)(`${o}/files`,`${p}/${e}/files`),!await(0,c.rename)(o,`${p}/${e}-old`))?await this.downloadError(e,s,d.version,[`No se puede renombrar de ${o} a ${p}/${e}-old`]):await(0,c.rename)(`${p}/${e}`,o)?(r?console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Nueva versión ${a.Colors.colorize([a.Colors.FgBlue],s)} => ${a.Colors.colorize([a.Colors.FgGreen],d.version)} [${a.Colors.colorize([a.Colors.FgGreen,a.Colors.Bright],"OK   ")}]`):console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Instalando ${a.Colors.colorize([a.Colors.FgGreen],d.version)} [${a.Colors.colorize([a.Colors.FgGreen,a.Colors.Bright],"OK   ")}]`),!0):await this.downloadError(e,s,d.version,[`No se puede renombrar de ${p}/${e} a ${o}`])}static async downloadError(e,o,r,t=[]){console.log(a.Colors.colorize([a.Colors.FgMagenta],e),`=> Nueva versión ${a.Colors.colorize([a.Colors.FgBlue],o)} => ${a.Colors.colorize([a.Colors.FgGreen],r)} [${a.Colors.colorize([a.Colors.FgRed,a.Colors.Bright],"ERROR")}]`),console.group();for(const e of t)console.log(a.Colors.colorize([a.Colors.FgYellow],e));return console.groupEnd(),Promise.reject()}static async clearTMP(e){(await(0,l.isDir)(e)||await(0,l.isFile)(e))&&await(0,c.unlink)(e)}}},433:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Init=void 0;const t=r(732),s=r(24),i=r(642),a=r(823),n=t.__importDefault(r(342)),l=t.__importDefault(r(326)),c=t.__importDefault(r(973)),u=t.__importDefault(r(225));o.Init=class{static async init(e){console.log(s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Inicializando")),console.group();const[o,r]=await this.initBase(e);await this.deleteFiles(e);const t=this.reduceConfig([await this.initServices(e,o),await this.initScripts(e,r)]);return await this.initConfig(e,o),await this.initYarnRC(e,t),console.groupEnd(),!0}static reduceConfig(e){return e.reduce(((e,o)=>({openTelemetry:e.openTelemetry||o.openTelemetry})),{openTelemetry:!1})}static async isValid(e){return await(0,a.isDir)(e)&&await(0,a.isFile)(`${e}/package.json`)}static async initBase(e){console.log(s.Colors.colorize([s.Colors.FgWhite],"Inicializando proyecto")),console.group();const o=[],r=[],t=await(0,a.readJSON)(`${e}/package.json`);if(t.scripts={mrpack:"yarn workspace services-comun mrpack",doctor:"yarn dlx @yarnpkg/doctor",devel:"yarn mrpack devel -e","devel-f":"yarn mrpack devel -e -f","g:devel":'cd "$INIT_CWD" && yarn node --watch --no-warnings devel.js',packd:"yarn mrpack devel -c","packd-f":"yarn mrpack devel -c -f","g:packd":'yarn workspace services-comun webpack --env entorno=desarrollo --config "$INIT_CWD/webpack.develop.config.js"',update:"yarn mrpack update"},await(0,a.isDir)(`${e}/framework`))for(const o of await(0,a.readDir)(`${e}/framework`))await this.isValid(`${e}/framework/${o}`)?t.scripts[o]=`yarn workspace ${o}`:await(0,a.unlink)(`${e}/framework/${o}`);if(await(0,a.isDir)(`${e}/services`))for(const r of await(0,a.readDir)(`${e}/services`))await this.isValid(`${e}/services/${r}`)?(t.scripts[r]=`yarn workspace ${r}`,o.push(r)):await(0,a.unlink)(`${e}/services/${r}`);if(await(0,a.isDir)(`${e}/packages`))for(const o of await(0,a.readDir)(`${e}/packages`))await this.isValid(`${e}/packages/${o}`)?t.scripts[o]=`yarn workspace ${o}`:await(0,a.unlink)(`${e}/packages/${o}`);if(await(0,a.isDir)(`${e}/scripts`))for(const o of await(0,a.readDir)(`${e}/scripts`))await this.isValid(`${e}/scripts/${o}`)?(t.scripts[o]=`yarn workspace ${o}`,r.push(o)):await(0,a.unlink)(`${e}/scripts/${o}`);if(await(0,a.isDir)(`${e}/statics`))for(const o of await(0,a.readDir)(`${e}/statics`))await this.isValid(`${e}/statics/${o}`)?t.scripts[o]=`yarn workspace ${o}`:await(0,a.unlink)(`${e}/statics/${o}`);return t.workspaces=["framework/*","packages/*","scripts/*","services/*","statics/*"],null!=t.dependencies&&delete t.dependencies,null!=t.devDependencies&&delete t.devDependencies,await(0,a.safeWrite)(`${e}/.gitattributes`,l.default,!0),await(0,a.safeWrite)(`${e}/.gitignore`,u.default,!0),await(0,a.safeWrite)(`${e}/package.json`,`${JSON.stringify(t,null,2)}\n`,!0),console.groupEnd(),[o,r]}static async deleteFiles(e){console.log(s.Colors.colorize([s.Colors.FgWhite],"Revisando archivos innecesarios")),console.group();for(const o of["update.sh","run.sh"])await(0,a.isFile)(`${e}/${o}`)&&(console.log(`Eliminando ${s.Colors.colorize([s.Colors.FgYellow],o)}`),await(0,a.unlink)(`${e}/${o}`));for(const o of await(0,a.readDir)(`${e}/framework`))for(const r of["download.js","upload.js"])await(0,a.isFile)(`${e}/framework/${o}/${r}`)&&(console.log(`Eliminando ${s.Colors.colorize([s.Colors.FgYellow],`${o}/${r}`)}`),await(0,a.unlink)(`${e}/framework/${o}/${r}`));console.groupEnd()}static async initServices(e,o){console.log(s.Colors.colorize([s.Colors.FgWhite],"Inicializando servicios")),console.group();const r=this.reduceConfig(await Promise.all(o.map((o=>this.initService(e,o)))));return console.groupEnd(),r}static async initService(e,o){const r=await(0,a.readJSON)(`${e}/framework/${process.env.npm_package_name}/package.json`),t=await(0,a.readJSON)(`${e}/services/${o}/package.json`);t.config??={},void 0!==t.config.nextjs&&"object"!=typeof t.config.nextjs&&(t.config.nextjs={});const l=t.config.nextjs??{},u=t.config.resources??t.resources??!1,d={};d.cronjob=t.config.cronjob??t.cronjob??!1,d.devel=t.config.devel??t.devel??!0,d.deploy=t.config.deploy??!0,d.generar=t.config.generar??t.generar??!1,d.unico=t.config.unico??t.unico??!1,d.deps=t.config.deps??[],d.storage=t.config.storage??t.storage??[],d.runtime=t.config.runtime??(u?i.ERuntime.browser:i.ERuntime.node),void 0!==t.config.framework?d.framework=t.config.framework:l.enabled?d.framework=i.EFramework.nextjs:d.framework=i.EFramework.meteored,void 0!==t.config.credenciales?d.credenciales=t.config.credenciales:d.credenciales=l.credenciales??[],t.config=d,null!=t.nodemonConfig&&delete t.nodemonConfig;let p=!1;if(t.config.generar){switch(t.scripts??={},t.config.framework){case i.EFramework.meteored:t.scripts.packd="yarn g:packd",d.runtime===i.ERuntime.node&&(t.config.cronjob?t.scripts.devel="yarn node --no-warnings devel.js":t.scripts.devel="yarn g:devel",t.version="0000.00.00-000");break;case i.EFramework.nextjs:t.scripts.dev??="yarn run next dev -- -p 8080"}d.runtime==i.ERuntime.node&&d.framework!=i.EFramework.nextjs&&(t.dependencies??={},t.devDependencies??={},t.dependencies["source-map-support"]??=r.devDependencies["source-map-support"],d.cronjob||(t.dependencies["@google-cloud/opentelemetry-cloud-trace-exporter"]??=r.devDependencies["@google-cloud/opentelemetry-cloud-trace-exporter"],t.dependencies["@opentelemetry/api"]??=r.devDependencies["@opentelemetry/api"],t.dependencies["@opentelemetry/core"]??=r.devDependencies["@opentelemetry/core"],t.dependencies["@opentelemetry/instrumentation"]??=r.devDependencies["@opentelemetry/instrumentation"],t.dependencies["@opentelemetry/instrumentation-http"]??=r.devDependencies["@opentelemetry/instrumentation-http"],t.dependencies["@opentelemetry/resources"]??=r.devDependencies["@opentelemetry/resources"],t.dependencies["@opentelemetry/sdk-trace-base"]??=r.devDependencies["@opentelemetry/sdk-trace-base"],t.dependencies["@opentelemetry/sdk-trace-node"]??=r.devDependencies["@opentelemetry/sdk-trace-node"],t.dependencies["@opentelemetry/semantic-conventions"]??=r.devDependencies["@opentelemetry/semantic-conventions"],t.dependencies.chokidar??=r.devDependencies.chokidar,t.dependencies.hexoid??=r.devDependencies.hexoid,t.devDependencies.formidable??=r.devDependencies.formidable,void 0!==t.dependencies["@google-cloud/trace-agent"]&&delete t.dependencies["@google-cloud/trace-agent"],void 0!==t.dependencies["@opentelemetry/context-async-hooks"]&&delete t.dependencies["@opentelemetry/context-async-hooks"],void 0!==t.dependencies.formidable&&delete t.dependencies.formidable,p=!0),void 0!==t.devDependencies["source-map-support"]&&delete t.devDependencies["source-map-support"],0==Object.keys(t.devDependencies).length&&delete t.devDependencies,0==Object.keys(t.dependencies).length&&delete t.dependencies,0==Object.keys(t.devDependencies).length&&delete t.devDependencies),await(0,a.safeWrite)(`${e}/services/${o}/package.json`,`${JSON.stringify(t,null,2)}\n`,!0)}return d.runtime==i.ERuntime.node&&d.framework!=i.EFramework.nextjs&&await Promise.all([(0,a.safeWrite)(`${e}/services/${o}/app.js`,n.default,!0),(0,a.safeWrite)(`${e}/services/${o}/devel.js`,c.default,!0),(0,a.safeWrite)(`${e}/services/${o}/init.js`,"",!1)]),await(0,a.isFile)(`${e}/services/${o}/output/.foreverignore`)&&(console.log(s.Colors.colorize([s.Colors.FgYellow],`Eliminando ${e}/services/${o}/output/.foreverignore`)),await(0,a.unlink)(`${e}/services/${o}/output/.foreverignore`)),await(0,a.isFile)(`${e}/services/${o}/output/devel.js`)&&(console.log(s.Colors.colorize([s.Colors.FgYellow],`Eliminando ${e}/services/${o}/output/devel.js`)),await(0,a.unlink)(`${e}/services/${o}/output/devel.js`)),await(0,a.isFile)(`${e}/services/${o}/output/devel.js.map`)&&(console.log(s.Colors.colorize([s.Colors.FgYellow],`Eliminando ${e}/services/${o}/output/devel.js.map`)),await(0,a.unlink)(`${e}/services/${o}/output/devel.js.map`)),await(0,a.isFile)(`${e}/services/${o}/pack.js`)&&(console.log(s.Colors.colorize([s.Colors.FgYellow],`Eliminando ${e}/services/${o}/pack.js`)),await(0,a.unlink)(`${e}/services/${o}/pack.js`)),{openTelemetry:p}}static async initScripts(e,o){console.log(s.Colors.colorize([s.Colors.FgWhite],"Inicializando scripts")),console.group();const r=this.reduceConfig(await Promise.all(o.map((o=>this.initScript(e,o)))));return console.groupEnd(),r}static async initScript(e,o){const r=await(0,a.readJSON)(`${e}/scripts/${o}/package.json`);return r.scripts??={},r.scripts.packd="yarn g:packd",await(0,a.safeWrite)(`${e}/scripts/${o}/package.json`,`${JSON.stringify(r,null,2)}\n`,!0),{openTelemetry:!1}}static async initConfig(e,o){console.log(s.Colors.colorize([s.Colors.FgWhite],"Inicializando configuración de workspaces")),console.group();const r=`${e}/config.workspaces.json`,t={devel:{available:[],disabled:[]},packd:{available:[],disabled:[]},services:{}};if(await(0,a.isFile)(r))try{const e=await(0,a.readJSON)(r);t.devel.disabled.push(...e?.devel?.disabled?.filter((e=>o.includes(e)))??[]),t.packd.disabled.push(...e?.packd?.disabled?.filter((e=>o.includes(e)))??[]),t.services=e.services??{}}catch(e){}for(const e of o)t.devel.disabled.includes(e)||t.devel.available.push(e),t.packd.disabled.includes(e)||t.packd.available.push(e);t.devel.available=t.devel.available.sort(),t.devel.available.push(""),t.devel.disabled=t.devel.disabled.sort(),t.devel.disabled.push(""),t.packd.available=t.packd.available.sort(),t.packd.available.push(""),t.packd.disabled=t.packd.disabled.sort(),t.packd.disabled.push(""),await(0,a.safeWrite)(r,JSON.stringify(t,null,2),!0),console.groupEnd()}static async initYarnRC(e,o){if(!o.openTelemetry)return;console.log(s.Colors.colorize([s.Colors.FgWhite],"Inicializando configuración de YARN")),console.group();const r=(await(0,a.readFileString)(`${e}/.yarnrc.yml`)).split("\n"),t=[];let i=[];const n=[];let l=0;for(const e of r)switch("packageExtensions:"==e?l=1:("plugins:"==e||e.startsWith("yarnPath:"))&&(l=2),l){case 0:t.push(e.trimEnd());break;case 1:i.push(e.trimEnd());break;case 2:n.push(e.trimEnd())}let c=!1,u=!1;i=i.filter((e=>e.length>0)),0==i.length&&i.push("packageExtensions:");const d={},p=["mysql2@*:"];o.openTelemetry&&(d["@google-cloud/opentelemetry-cloud-trace-exporter"]="@opentelemetry/semantic-conventions",d["@google-cloud/opentelemetry-resource-util"]="@opentelemetry/api");for(const[e,o]of Object.entries(d))i.includes(`  "${e}@*":`)||(i.push(`  "${e}@*":`),i.push("    dependencies:"),i.push(`      "${o}": "*"`),c=!0);for(const e of p){const o=i.indexOf(`  ${e}@*:`);o>=0&&(i.splice(o,3),c=!0)}i=i.filter((e=>e.length>0)),1==i.length&&(i=[],c=!0),c&&(i.length>0&&i.push(""),await(0,a.safeWrite)(`${e}/.yarnrc.yml`,[...t,...i,...n].join("\n"),!0)),console.groupEnd()}}},342:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default='\nprocess.env.ZONA ??= "desarrollo";\n\nSymbol.dispose ??= Symbol("Symbol.dispose");\nSymbol.asyncDispose ??= Symbol("Symbol.asyncDispose");\n\nrequire("./init");\nrequire("source-map-support").install();\nrequire("./output/app");\n'.trimStart()},326:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default="\n.yarn/releases/*.*js binary\n.yarn/plugins/*.*js binary\n**/tools/bin/*.*js binary\n".trimStart()},973:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default='\n// require("source-map-support").install();\nrequire("./app");\n'.trimStart()},225:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.default="\n.idea/dataSources.xml\n.idea/watcherTasks.xml\n.idea/php.xml\n.DS_Store\n.idea/workspace.xml\n.next/\n.pnp.*\n.yarn/*\n!.yarn/patches\n!.yarn/plugins\n!.yarn/releases\n!.yarn/sdks\n!.yarn/versions\n**/files/*\n**/output/*\n!**/output/.foreverignore\nconfig.workspaces.json\nservices-*/files\nservices-*/output\ntmp/\ntsconfig.tsbuildinfo\nvendor/\n**/.env*.local\n".trimStart()},939:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Log=void 0;const t=r(575),s=r(24);class i{static label_base=`${s.Colors.colorize([s.Colors.FgYellow,s.Colors.Underscore],"ENTORNO")} `;static label_compilar=`${s.Colors.colorize([s.Colors.FgGreen,s.Colors.Underscore],"GENERAR")} `;static label_ejecutar=`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Underscore],"EJECUTAR")}`;static generarFechaLog(e){return`[${t.Fecha.generarHora(new Date,!1)}][${e.type}][${e.label}]`}static info(e,...o){o.length>0&&console.info(this.generarFechaLog(e),...o)}static error(e,...o){o.length>0&&console.error(this.generarFechaLog(e),...o)}}o.Log=i},112:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Update=void 0;const t=r(401),s=r(433),i=r(162);o.Update=class{static async init(e){await s.Init.init(e),await t.Framework.update(e),await i.Yarn.update(e)}}},131:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Workspace=void 0;const t=r(732),s=r(561),i=t.__importDefault(r(612));o.Workspace=class{nombre;root;dir;hijos;iniciado;watcher;constructor(e){this.nombre=e.nombre,this.root=e.root,this.dir=`${e.root}/${e.path}/${e.nombre}`,this.hijos=[],this.iniciado=!1}addHijo(e){this.hijos.push(e)}async init(){this.iniciado||(this.iniciado=!0,await this.run(),this.initWatcher())}initWatcher(){this.watcher?.close(),"linux"!=i.default.platform()&&(this.watcher=(0,s.watch)(this.dir,{recursive:!0},((e,o)=>{o?.endsWith("~")||this.cambio()})))}cambio(){for(const e of this.hijos)e.cambio()}async run(){}}},437:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Compilar=void 0;const t=r(954),s=r(642),i=r(823),a=r(617);o.Compilar=class{basedir;name;packagejson;static async build(e,o){const r=`${e}/services/${o}`;return await(0,i.isDir)(r)&&await(0,i.isFile)(`${r}/package.json`)?new this(e,o,await(0,i.readJSON)(`${r}/package.json`)):(console.error(o,"[ERROR]","Servicio no válido"),null)}static async md5Deps(e){const o=`${e}/.yarn/cache`;if(!await(0,i.isDir)(o))return;const r=`${o}/.md5`;await(0,i.isFile)(r)&&await(0,i.unlink)(r),await(0,i.safeWrite)(r,`${await(0,i.md5Dir)(o)}\n`,!0)}config;dependencias;pendientes;dir;constructor(e,o,r){this.basedir=e,this.name=o,this.packagejson=r,this.config=r.config,this.dependencias=[],this.pendientes={},this.dir=`${e}/services/${o}`;for(const e of this.config.deps)this.pendientes[e]=null}async guardar(){await(0,i.safeWrite)(`${this.dir}/package.json`,`${JSON.stringify(this.packagejson,null,2)}\n`,!0,!0)}checkDependencias(e){for(const o of e)o.config.deps.includes(this.name)&&this.dependencias.push(o)}async pack(e,o){if(null!=o){delete this.pendientes[o.name];const e=Object.keys(this.pendientes);if(e.length>0)return void console.log(this.name,"[     ]","Esperando dependencias:",e.join(", "))}if(!this.config.generar||!this.config.deploy)return 0==this.dependencias.length?void console.log(this.name,"[OK   ]","Servicio desactivado para despliegue"):(console.warn(this.name,"[WARN ]","Servicio desactivado para despliegue. Hay servicios dependientes que podrían no generarse correctamente:",this.dependencias.map((e=>e.name)).join(", ")),Promise.all(this.dependencias.map((o=>o.pack(e,this)))).then((()=>{})));switch(await this.prepararCredenciales(),this.config.framework){case s.EFramework.meteored:await this.packMeteored(e);break;case s.EFramework.nextjs:await this.packNextJS(e)}return console.log(this.name,"[OK   ]","Servicio compilado"),0!=this.dependencias.length?Promise.all(this.dependencias.map((o=>o.pack(e,this)))).then((()=>{})):void 0}async packMeteored(e){switch(this.config.runtime){case s.ERuntime.browser:await this.webpack(e),await this.checkVersionBrowser();break;case s.ERuntime.node:await this.webpack(e),await this.checkVersionService(e,[`${this.basedir}/.yarnrc.yml`,`${this.dir}/output`,await(0,i.isFile)(`${this.dir}/Dockerfile`)?`${this.dir}/Dockerfile`:`${this.basedir}/framework/services-comun/despliegue/Dockerfile`,`${this.dir}/app.js`,`${this.dir}/assets`]);break;case s.ERuntime.php:await this.checkVersionService(e,[`${this.dir}/assets`,`${this.dir}/base/nginx/local.conf`,`${this.dir}/autoload.php`,`${this.dir}/composer.json`,`${this.dir}/composer.lock`,await(0,i.isFile)(`${this.dir}/Dockerfile`)?`${this.dir}/Dockerfile`:`${this.basedir}/framework/services-comun/despliegue/Dockerfile-php`,`${this.dir}/Dockerfile`,`${this.dir}/index.php`,`${this.dir}/Meteored`,`${this.dir}/vendor`])}}async webpack(e){const{status:o,stderr:r}=await t.Comando.spawn("yarn",["workspace","services-comun","webpack","--env",`entorno=${e}`,"--config",`${this.dir}/webpack.production.config.js`],{cwd:this.basedir});if(0!=o)return console.error(this.name,"[KO   ]","Error compilando:"),console.error(r),Promise.reject()}async packNextJS(e){const o="test"==e?"test":"production";await(0,i.isFile)(`${this.dir}/.env.${o}.local`)?await(0,i.safeWrite)(`${this.dir}/.env.local`,await(0,i.readFileString)(`${this.dir}/.env.${o}.local`),!0,!0):await(0,i.isFile)(`${this.dir}/.env.local`)||await(0,i.safeWrite)(`${this.dir}/.env.local`,`ENV=${e}`,!0,!0);{const{status:e,stderr:o}=await t.Comando.spawn("yarn",["run",this.name,"run","next","build"],{cwd:this.basedir});if(0!=e)return console.error(this.name,"[KO   ]","Error compilando:"),console.error(o),Promise.reject()}await this.checkVersionService(e,[`${this.basedir}/.yarnrc.yml`,`${this.dir}/output`,await(0,i.isFile)(`${this.dir}/Dockerfile`)?`${this.dir}/Dockerfile`:`${this.basedir}/framework/services-comun/despliegue/Dockerfile-next`,`${this.basedir}/framework/services-comun/next.config.js`,`${this.basedir}/framework/services-comun/next.config.deps.js`,`${this.dir}/next.config.js`,`${this.dir}/public`])}async checkVersionService(e,o){const r=[];if(await(0,i.isFile)(`${this.dir}/tags.json`)){let e=await(0,i.readJSON)(`${this.dir}/tags.json`).catch((()=>{}));Array.isArray(e)&&(e=e[0]),null!=e?.tags&&Array.isArray(e.tags)&&r.push(...e.tags.filter((e=>!["latest","produccion","test"].includes(e))))}let t,s,n;for(const e of r){const o=/^(\d{4}\.\d{2}\.\d{2})-(\d{3,})(.*)$/.exec(e);null==o?n=e:(t=o[1],s=o[2])}for(const e of this.config.deps)o.push(`${this.basedir}/services/${e}/hash.txt`);const l=[JSON.stringify(this.packagejson.dependencies??{})];for(const e of o)l.push(await(0,i.md5Dir)(e));const c=`${(0,a.md5)(l.filter((e=>e.length>0)).map((e=>(0,a.md5)(e))).join("")).substring(0,8)}-${e}`;if(null==t||null==s||n!=c){const e=new Date,o=[e.getUTCFullYear(),`0${e.getUTCMonth()+1}`.slice(-2),`0${e.getUTCDate()}`.slice(-2)].join(".");let r;r=t==o?`00${parseInt(s??"0")+1}`.slice(-3):"001",this.packagejson.version=`${o}-${r}`,await(0,i.safeWrite)(`${this.dir}/nuevo.txt`,"1",!0,!0)}else this.packagejson.version=`${t}-${s}`;await(0,i.safeWrite)(`${this.dir}/version.txt`,`${this.packagejson.version}-${e}`,!0,!0),await(0,i.safeWrite)(`${this.dir}/hash.txt`,c,!0,!0),await this.guardar()}async checkVersionBrowser(){const e=await(0,i.md5Dir)(`${this.dir}/output`);await(0,i.safeWrite)(`${this.dir}/output/hash.txt`,e,!0,!0),await(0,i.safeWrite)(`${this.dir}/hash.txt`,e,!0,!0)}async prepararCredenciales(){let e;await(0,i.mkdir)(`${this.dir}/files/credenciales/`,!0),await(0,i.isFile)(`${this.basedir}/mysql.txt`)&&(e=`/root/${await(0,i.readFileString)(`${this.basedir}/mysql.txt`)}`);for(const{source:o,target:r}of this.config.credenciales)if(await(0,i.isFile)(`${this.basedir}/kustomizar/tmp/credenciales/${o}`)){const t=await(0,i.readFileString)(`${this.basedir}/kustomizar/tmp/credenciales/${o}`);if(await(0,i.safeWrite)(`${this.dir}/files/credenciales/${r}`,t),null!=e&&"mysql.json"==r){const o=JSON.parse(t);if(null!=o.master)if(o.master.socketPath=e,null!=o.slaves&&Array.isArray(o.slaves))for(const r of o.slaves)r.socketPath=e;else o.slaves=[o.master];else if(null!=o.slaves&&Array.isArray(o.slaves))for(const r of o.slaves)r.socketPath=e;null!=o.socketPath&&(o.socketPath=e),await(0,i.safeWrite)(`${this.dir}/files/credenciales/${r}`,JSON.stringify(o))}}}}},642:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Service=o.EFramework=o.ERuntime=void 0;const t=r(732),s=r(718),i=r(561),a=t.__importDefault(r(612)),n=t.__importDefault(r(618)),l=r(24),c=r(131),u=r(823),d=r(939);var p,g;!function(e){e.node="node",e.browser="browser",e.php="php"}(p||(o.ERuntime=p={})),function(e){e.meteored="meteored",e.nextjs="nextjs"}(g||(o.EFramework=g={}));class h extends c.Workspace{static TIMEOUT=3e5;static COMPILABLES=[p.node,p.browser];static PAUSABLES=[g.meteored];compilar;ejecutar;label;global_compilar;global_ejecutar;config;compilador;ejecucion;timeout;constructor(e){super(e);const o=e.nombre.padEnd(e.pad),r=l.Colors.nextColor();this.compilar=e.compilar||e.forzar,this.ejecutar=e.ejecutar,this.label=l.Colors.colorize(r,o),this.global_compilar=!e.global.packd.disabled.includes(this.nombre),this.global_ejecutar=!e.global.devel.disabled.includes(this.nombre),this.config=(0,u.readJSON)(`${this.dir}/package.json`).then((e=>e.config??{}))}initWatcher(){this.watcher?.close(),"linux"!=a.default.platform()?this.watcher=(0,i.watch)(this.dir,{recursive:!0},((e,o)=>{o?.endsWith("~")||("package.json"==o&&this.updatePackageFile(),this.cambio())})):this.watcher=(0,i.watch)(`${this.dir}/package.json`,(()=>{this.updatePackageFile()}))}cambio(){this.runCompilar().then((()=>{})).catch((e=>{d.Log.error({type:d.Log.label_base,label:this.label},"Error reiniciando el compilador",e)}));for(const e of this.hijos)e.cambio()}setTimeoutCompilador(){"linux"!=a.default.platform()&&(null!=this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.stopCompilar().then((()=>{})).catch((e=>{d.Log.error({type:d.Log.label_base,label:this.label},"Error pausando el compilador",e)}))}),h.TIMEOUT))}updatePackageFile(){this.config=(0,u.readJSON)(`${this.dir}/package.json`).then((e=>e.config??{})),this.run().then((()=>{})).catch((e=>{d.Log.error({type:d.Log.label_base,label:this.label},"Error aplicando configuración específica",e)}))}updateGlobal(e){this.global_compilar=!e.packd.disabled.includes(this.nombre),this.global_ejecutar=!e.devel.disabled.includes(this.nombre),this.run().then((()=>{})).catch((e=>{d.Log.error({type:d.Log.label_base,label:this.label},"Error aplicando configuración global",e)}))}async run(){await super.run(),await Promise.all([this.runCompilar(),this.runEjecutar()])}async runCompilar(){await this.checkCompilar()?await this.initCompilar():await this.stopCompilar()}async runEjecutar(){await this.checkEjecucion()?await this.initEjecutar():await this.stopEjecutar()}async checkCompilar(){return!!this.compilar&&(this.global_compilar?!!(await this.config).generar||(null==this.compilador&&d.Log.info({type:d.Log.label_compilar,label:this.label},`Omitiendo workspace "${this.nombre}"`),!1):(null==this.compilador&&d.Log.info({type:d.Log.label_compilar,label:this.label},`Omitiendo workspace "${this.nombre}" (global)`),!1))}async initCompilar(){const e=await this.config;if(!h.COMPILABLES.includes(e.runtime))return;if(h.PAUSABLES.includes(e.framework)&&this.setTimeoutCompilador(),null!=this.compilador)return;let o;switch(e.framework){case g.nextjs:o="dev";break;case g.meteored:default:o="packd"}d.Log.info({type:d.Log.label_compilar,label:this.label},"Iniciando compilador"),this.compilador=(0,s.spawn)("yarn",["run",this.nombre,"run",o],{cwd:this.root,env:{...process.env,FORCE_COLOR:"1"},stdio:"pipe",shell:!0}),this.compilador.stdout.on("data",(e=>{const o=e.toString().split("\n").filter((e=>e.length>0));for(const e of o)d.Log.info({type:d.Log.label_compilar,label:this.label},e)})),this.compilador.stderr.on("data",(e=>{const o=e.toString().split("\n").filter((e=>e.length>0));for(const e of o)d.Log.error({type:d.Log.label_compilar,label:this.label},e)})),this.compilador.on("error",(e=>{d.Log.error({type:d.Log.label_compilar,label:this.label},l.Colors.colorize([l.Colors.FgRed,l.Colors.Bright],"Error de compilador"),e)}))}async stopCompilar(){return new Promise(((e,o)=>{null!=this.compilador?(d.Log.info({type:d.Log.label_compilar,label:this.label},"Deteniendo compilador (",this.compilador.pid,")"),null!=this.compilador.pid?(0,n.default)(this.compilador.pid,(r=>{r?(d.Log.error({type:d.Log.label_compilar,label:this.label},"Deteniendo compilador => KO",r),o(r)):(d.Log.info({type:d.Log.label_compilar,label:this.label},"Deteniendo compilador => OK"),this.compilador=void 0,e())})):e()):e()}))}async checkEjecucion(){const e=await this.config;return!(!this.ejecutar||e.runtime==p.browser||[g.nextjs].includes(e.framework)||(this.global_ejecutar?!e.devel&&(null==this.ejecucion&&d.Log.info({type:d.Log.label_ejecutar,label:this.label},`Omitiendo workspace "${this.nombre}"`),1):(null==this.ejecucion&&d.Log.info({type:d.Log.label_ejecutar,label:this.label},`Omitiendo workspace "${this.nombre}" (global)`),1)))}async initEjecutar(){if(null!=this.ejecucion)return;d.Log.info({type:d.Log.label_ejecutar,label:this.label},"Iniciando ejecución");const e=await this.config;this.ejecucion=(0,s.spawn)("yarn",["run",this.nombre,"run","devel"],{cwd:this.root,env:{...process.env,FORCE_COLOR:"1"},stdio:"pipe",shell:!0}),this.ejecucion.stdout.on("data",(e=>{const o=e.toString().split("\n").filter((e=>e.length>0));for(const e of o)d.Log.info({type:d.Log.label_ejecutar,label:this.label},e)})),this.ejecucion.stderr.on("data",(e=>{const o=e.toString().split("\n").filter((e=>e.length>0));for(const e of o)d.Log.error({type:d.Log.label_ejecutar,label:this.label},e)})),this.ejecucion.on("error",(e=>{d.Log.error({type:d.Log.label_ejecutar,label:this.label},l.Colors.colorize([l.Colors.FgRed,l.Colors.Bright],"Error de ejecución"),e)})),this.ejecucion.on("close",(o=>{0!=(o=o??0)?(d.Log.error({type:d.Log.label_ejecutar,label:this.label},"Terminado (",o,") Programando nueva ejecución en 30 segundos"),setTimeout((()=>{this.runEjecutar().then((()=>{})).catch((e=>{d.Log.error({type:d.Log.label_ejecutar,label:this.label},"Error en reinicio",e)}))}),3e4)):e.cronjob&&(d.Log.info({type:d.Log.label_ejecutar,label:this.label},"Terminado: Programando nueva ejecución en 10 minutos"),this.ejecucion=void 0,setTimeout((()=>{this.runEjecutar().then((()=>{})).catch((e=>{d.Log.error({type:d.Log.label_ejecutar,label:this.label},"Error en inicio programado",e)}))}),6e5))}))}async stopEjecutar(){return new Promise(((e,o)=>{null!=this.ejecucion?(d.Log.info({type:d.Log.label_ejecutar,label:this.label},"Deteniendo ejecución (",this.ejecucion.pid,")"),null!=this.ejecucion.pid?(0,n.default)(this.ejecucion.pid,(r=>{r?(d.Log.error({type:d.Log.label_ejecutar,label:this.label},"Deteniendo ejecución => KO",r),o(r)):(d.Log.info({type:d.Log.label_ejecutar,label:this.label},"Deteniendo ejecución => OK"),this.ejecucion=void 0,e())})):e()):e()}))}}o.Service=h},162:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Yarn=void 0;const t=r(718),s=r(24),i=r(954),a=r(823);o.Yarn=class{static async update(e){console.log(s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Actualizando YARN")),console.group();const{anterior:o,nueva:r}=await this.updateBase(e),t=o!=r;let i=t;t&&(await(0,a.safeWrite)(`${e}/${o}`,await(0,a.readFileBuffer)(`${e}/${r}`)),s.Colors.resetNext()),console.groupEnd(),i&&await this.install(e,{verbose:!1});const n=await(0,a.readFileString)(`${e}/yarn.lock`),l=await this.upgrade(e),c=await(0,a.readFileString)(`${e}/yarn.lock`);0!=l||!t&&n==c||await this.install(e,{verbose:!1}),t&&await(0,a.unlink)(`${e}/${o}`)}static async getPath(e){const o=await(0,a.readFileString)(`${e}/.yarnrc.yml`);return o.split("yarnPath:").at(1)?.trim()??"0.0.0"}static async updateBase(e){console.log(s.Colors.colorize([s.Colors.FgWhite],"Versión de Yarn")),console.group();const o=await this.getPath(e),{status:r,stderr:t}=await i.Comando.spawn("yarn",["set","version","latest"],{cwd:e});if(0!=r)return console.error(s.Colors.colorize([s.Colors.FgRed,s.Colors.Bright],"ERROR")),console.error(t),console.groupEnd(),Promise.reject();const a=await this.getPath(e),n=a.split("/").at(-1)?.split("-").at(-1)?.split(".").slice(0,3).join(".")??"0.0.0";return o!=a?console.log(`${s.Colors.colorize([s.Colors.FgGreen],n)} (Nueva versión)`):console.log(`${s.Colors.colorize([s.Colors.FgBlue],n)} (Sin cambios)`),console.groupEnd(),{anterior:o,nueva:a}}static async install(e,{verbose:o}={}){o??=!0,console.log(s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Reinstalando dependencias")),console.group();{const{status:r,stdout:t,stderr:a}=await i.Comando.spawn("yarn",["install"],{cwd:e});if(0!=r)return console.error(`[${s.Colors.colorize([s.Colors.FgRed,s.Colors.Bright],"ERROR")}]`),console.log(a),console.groupEnd(),Promise.reject();o&&console.log(t)}{console.log("Optimizando dependencias");const{status:r,stdout:t}=await i.Comando.spawn("yarn",["dedupe","--strategy","highest"],{cwd:e});0==r?console.error(`[${s.Colors.colorize([s.Colors.FgGreen,s.Colors.Bright],"OK   ")}]`):console.error(`[${s.Colors.colorize([s.Colors.FgRed,s.Colors.Bright],"ERROR")}]`),o&&console.log(t)}console.groupEnd()}static async upgrade(e){return console.log(s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Actualizando dependencias")),console.group(),new Promise((o=>{(0,t.spawn)("yarn",["upgrade-interactive"],{cwd:e,shell:!0,stdio:[process.stdin,process.stdout,process.stderr]}).on("error",(e=>{console.error("Error actualizando dependencias",e)})).on("close",(e=>{console.groupEnd(),o(e??0)}))}))}}},892:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Modulo=void 0;const t=r(732),s=r(261),i=t.__importDefault(r(411)),a=r(173);o.Modulo=class{config;static OPTIONS={options:{help:{type:"boolean",short:"h",default:!1}},strict:!0,allowPositionals:!0};static run(e){(0,a.PromiseDelayed)().then((async()=>e.run())).catch((e=>{null!=e&&console.error(e)}))}root;constructor(e){this.config=e,this.root=i.default.resolve(process.cwd(),"../..")}async run(){const{values:e,positionals:o}=(0,s.parseArgs)(this.config);await this.parsePositionals(o),await this.parseParams(e,o)}async parsePositionals(e){}}},153:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ModuloDeploy=void 0;const t=r(892),s=r(24),i=r(654);class a extends t.Modulo{static OPTIONS={...t.Modulo.OPTIONS,options:{...t.Modulo.OPTIONS.options,env:{type:"string"}},strict:!0};static run(){super.run(new this(this.OPTIONS))}constructor(e){super(e)}async parseParams(e){e.help||null==e.env||!["produccion","test"].includes(e.env)?this.mostrarAyuda():i.Deploy.run(this.root,e.env)}mostrarAyuda(){console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Descripción")}: Compila el proyecto para producción`),console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Uso")}:         ${s.Colors.colorize([s.Colors.FgBlue],"yarn mrpack")} ${s.Colors.colorize([s.Colors.FgGreen],"deploy")} ${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}`),console.log(""),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}:`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgMagenta],"Opciones disponibles:")}`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"--env")}=${s.Colors.colorize([s.Colors.FgGreen],"<entorno>")}: Indica el entorno de compilación`),console.log(`                 ${s.Colors.colorize([s.Colors.FgWhite],"Valores posibles:")} ${s.Colors.colorize([s.Colors.FgGreen],"produccion")}${s.Colors.colorize([s.Colors.FgWhite],",")} ${s.Colors.colorize([s.Colors.FgGreen],"test")}`),console.groupEnd(),console.groupEnd(),console.log(""),console.groupEnd()}}o.ModuloDeploy=a},847:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ModuloDevel=void 0;const t=r(892),s=r(24),i=r(449);class a extends t.Modulo{static OPTIONS={...t.Modulo.OPTIONS,options:{...t.Modulo.OPTIONS.options,compilar:{type:"boolean",short:"c",default:!1},ejecutar:{type:"boolean",short:"e",default:!1},forzar:{type:"boolean",short:"f",default:!1}},strict:!0};static run(){super.run(new this(this.OPTIONS))}constructor(e){super(e)}async parseParams(e){e.help?this.mostrarAyuda():await i.Devel.run(this.root,e)}mostrarAyuda(){console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Descripción")}: Inicia la compilación/ejecución de los workspaces del proyecto`),console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Uso")}:         ${s.Colors.colorize([s.Colors.FgBlue],"yarn mrpack")} ${s.Colors.colorize([s.Colors.FgGreen],"devel")} ${s.Colors.colorize([s.Colors.FgYellow],"[opciones] [adicional]")}`),console.log(""),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}:`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgMagenta],"Opciones disponibles:")}`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgBlue],"-c")} ${s.Colors.colorize([s.Colors.FgYellow],"--compilar")}: Compila los workspaces habilitados`),console.log(`${s.Colors.colorize([s.Colors.FgBlue],"-e")} ${s.Colors.colorize([s.Colors.FgYellow],"--ejecutar")}: Ejecuta los workspaces habilitados`),console.groupEnd(),console.groupEnd(),console.log(""),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"[adicional]")}:`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgMagenta],"Opciones adicionales disponibles:")}`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgBlue],"-f")} ${s.Colors.colorize([s.Colors.FgYellow],"--forzar")}:   Ejecuta los workspaces habilitados`),console.groupEnd(),console.groupEnd(),console.log(""),console.groupEnd()}}o.ModuloDevel=a},907:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ModuloFramework=void 0;const t=r(892),s=r(24),i=r(401);class a extends t.Modulo{static OPTIONS={...t.Modulo.OPTIONS,options:{...t.Modulo.OPTIONS.options,add:{type:"string",multiple:!0},remove:{type:"string",multiple:!0}},strict:!0};static run(){super.run(new this(this.OPTIONS))}constructor(e){super(e)}async parseParams(e){e.help?this.mostrarAyuda():(null!=e.add&&await i.Framework.add(this.root,e.add),null!=e.remove&&await i.Framework.remove(this.root,e.remove))}mostrarAyuda(){console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Descripción")}: Operaciones sobre los frameworks`),console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Uso")}:         ${s.Colors.colorize([s.Colors.FgBlue],"yarn mrpack")} ${s.Colors.colorize([s.Colors.FgGreen],"deploy")} ${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}`),console.log(""),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}:`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgMagenta],"Opciones disponibles:")}`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"--add")}=${s.Colors.colorize([s.Colors.FgGreen],"<framework>")}:    Añade un framework`),console.log(`                      ${s.Colors.colorize([s.Colors.FgWhite],"Se puede especificar múltiples veces")}`),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"--remove")}=${s.Colors.colorize([s.Colors.FgGreen],"<framework>")}: Elimina un framework`),console.log(`                      ${s.Colors.colorize([s.Colors.FgWhite],"Se puede especificar múltiples veces")}`),console.groupEnd(),console.groupEnd(),console.log(""),console.groupEnd()}}o.ModuloFramework=a},397:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ModuloInit=void 0;const t=r(892),s=r(24),i=r(433);class a extends t.Modulo{static OPTIONS={...t.Modulo.OPTIONS,options:{...t.Modulo.OPTIONS.options},strict:!0};static run(){super.run(new this(this.OPTIONS))}constructor(e){super(e)}async parseParams(e){e.help?this.mostrarAyuda():await i.Init.init(this.root)}mostrarAyuda(){console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Descripción")}: Inicializa la configuración del proyecto.`),console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Uso")}:         ${s.Colors.colorize([s.Colors.FgBlue],"yarn mrpack")} ${s.Colors.colorize([s.Colors.FgGreen],"init")} ${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}`),console.log(""),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}:`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgMagenta],"Opciones disponibles:")}`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgBlue],"-h")} ${s.Colors.colorize([s.Colors.FgYellow],"--help")}:  Muestra la ayuda`),console.groupEnd(),console.groupEnd(),console.log(""),console.groupEnd()}}o.ModuloInit=a},230:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ModuloUpdate=void 0;const t=r(892),s=r(24),i=r(112);class a extends t.Modulo{static OPTIONS={...t.Modulo.OPTIONS,options:{...t.Modulo.OPTIONS.options},strict:!0};static run(){super.run(new this(this.OPTIONS))}constructor(e){super(e)}async parseParams(e){e.help?this.mostrarAyuda():await i.Update.init(this.root)}mostrarAyuda(){console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Descripción")}: Inicializa la configuración del proyecto y actualiza las librerías`),console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Uso")}:         ${s.Colors.colorize([s.Colors.FgBlue],"yarn mrpack")} ${s.Colors.colorize([s.Colors.FgGreen],"update")} ${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}`),console.log(""),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}:`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgMagenta],"Opciones disponibles:")}`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgBlue],"-h")} ${s.Colors.colorize([s.Colors.FgYellow],"--help")}:  Muestra la ayuda`),console.groupEnd(),console.groupEnd(),console.log(""),console.groupEnd()}}o.ModuloUpdate=a},290:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.ModuloUpload=void 0;const t=r(892),s=r(24),i=r(401);class a extends t.Modulo{static OPTIONS={...t.Modulo.OPTIONS,options:{...t.Modulo.OPTIONS.options},strict:!0};static run(){super.run(new this(this.OPTIONS))}constructor(e){super(e)}async parseParams(e){e.help?this.mostrarAyuda():await i.Framework.push(this.root)}mostrarAyuda(){console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Descripción")}: Sube los frameworks para compartirlos entre proyectos`),console.log(`${s.Colors.colorize([s.Colors.FgCyan,s.Colors.Bright],"Uso")}:         ${s.Colors.colorize([s.Colors.FgBlue],"yarn mrpack")} ${s.Colors.colorize([s.Colors.FgGreen],"upload")} ${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}`),console.log(""),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgYellow],"[opciones]")}:`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgMagenta],"Opciones disponibles:")}`),console.group(),console.log(`${s.Colors.colorize([s.Colors.FgBlue],"-h")} ${s.Colors.colorize([s.Colors.FgYellow],"--help")}:  Muestra la ayuda`),console.groupEnd(),console.groupEnd(),console.log(""),console.groupEnd()}}o.ModuloUpload=a},245:(e,o,r)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.MRPack=void 0;const t=r(24),s=r(892),i=r(847),a=r(153),n=r(397),l=r(230),c=r(290),u=r(907);class d extends s.Modulo{static OPTIONS={...s.Modulo.OPTIONS,options:{...s.Modulo.OPTIONS.options},strict:!1};static MODULOS=["devel","deploy","framework","init","update","upload"];static run(){super.run(new this(this.OPTIONS))}constructor(e){super(e)}async parsePositionals(e){if(1!=e.length||!d.MODULOS.includes(e[0]))return this.mostrarAyuda(),Promise.reject()}async parseParams(e,o){switch(o[0]){case"devel":i.ModuloDevel.run();break;case"deploy":a.ModuloDeploy.run();break;case"framework":u.ModuloFramework.run();break;case"init":n.ModuloInit.run();break;case"update":l.ModuloUpdate.run();break;case"upload":c.ModuloUpload.run();break;default:return this.mostrarAyuda(),Promise.reject()}}mostrarAyuda(){console.log(`${t.Colors.colorize([t.Colors.FgCyan,t.Colors.Bright],"Uso")}: ${t.Colors.colorize([t.Colors.FgBlue],"yarn mrpack")} ${t.Colors.colorize([t.Colors.FgGreen],"<modulo>")} ${t.Colors.colorize([t.Colors.FgYellow],"[opciones]")}`),console.log(""),console.group(),console.log(`${t.Colors.colorize([t.Colors.FgGreen],"<modulo>")}:`),console.group(),console.log("Indica el módulo a ejecutar."),console.log(`${t.Colors.colorize([t.Colors.FgMagenta],"Módulos disponibles:")}`),console.group(),console.log(`${t.Colors.colorize([t.Colors.FgBlue],"devel")}:     Inicia el entorno de desarrollo`),console.log(`${t.Colors.colorize([t.Colors.FgBlue],"deploy")}:    Compila el proyecto en modo producción`),console.log(`${t.Colors.colorize([t.Colors.FgBlue],"framework")}: Operaciones sobre los frameworks`),console.log(`${t.Colors.colorize([t.Colors.FgBlue],"init")}:      Inicializa la configuración del proyecto`),console.log(`${t.Colors.colorize([t.Colors.FgBlue],"update")}:    Actualiza las librerías`),console.log(`${t.Colors.colorize([t.Colors.FgBlue],"upload")}:    Sube los frameworks para compartirlos entre proyectos`),console.groupEnd(),console.log(`${t.Colors.colorize([t.Colors.FgRed],"Solo puede indicarse uno")}`),console.groupEnd(),console.log(""),console.log(`${t.Colors.colorize([t.Colors.FgYellow],"[opciones]")}:`),console.group(),console.log("Permiten customizar el módulo."),console.log(`${t.Colors.colorize([t.Colors.FgMagenta],"Opciones disponibles:")}`),console.group(),console.log(`${t.Colors.colorize([t.Colors.FgBlue],"-h")} ${t.Colors.colorize([t.Colors.FgYellow],"--help")}:  Muestra la ayuda`),console.log(`            ${t.Colors.colorize([t.Colors.FgWhite],"Puede especificar esta opción en cualquier momento para mostrar la ayuda del módulo")}`),console.groupEnd(),console.groupEnd(),console.log(""),console.groupEnd()}}o.MRPack=d},81:e=>{e.exports=require("child_process")},718:e=>{e.exports=require("node:child_process")},878:e=>{e.exports=require("node:cluster")},5:e=>{e.exports=require("node:crypto")},561:e=>{e.exports=require("node:fs")},977:e=>{e.exports=require("node:fs/promises")},612:e=>{e.exports=require("node:os")},411:e=>{e.exports=require("node:path")},492:e=>{e.exports=require("node:stream")},261:e=>{e.exports=require("node:util")},732:(e,o,r)=>{r.r(o),r.d(o,{__addDisposableResource:()=>T,__assign:()=>i,__asyncDelegator:()=>j,__asyncGenerator:()=>k,__asyncValues:()=>_,__await:()=>F,__awaiter:()=>h,__classPrivateFieldGet:()=>E,__classPrivateFieldIn:()=>D,__classPrivateFieldSet:()=>z,__createBinding:()=>m,__decorate:()=>n,__disposeResources:()=>B,__esDecorate:()=>c,__exportStar:()=>w,__extends:()=>s,__generator:()=>f,__importDefault:()=>M,__importStar:()=>P,__makeTemplateObject:()=>O,__metadata:()=>g,__param:()=>l,__propKey:()=>d,__read:()=>C,__rest:()=>a,__runInitializers:()=>u,__setFunctionName:()=>p,__spread:()=>$,__spreadArray:()=>v,__spreadArrays:()=>b,__values:()=>y,default:()=>N});var t=function(e,o){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])},t(e,o)};function s(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}var i=function(){return i=Object.assign||function(e){for(var o,r=1,t=arguments.length;r<t;r++)for(var s in o=arguments[r])Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);return e},i.apply(this,arguments)};function a(e,o){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&o.indexOf(t)<0&&(r[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(t=Object.getOwnPropertySymbols(e);s<t.length;s++)o.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(r[t[s]]=e[t[s]])}return r}function n(e,o,r,t){var s,i=arguments.length,a=i<3?o:null===t?t=Object.getOwnPropertyDescriptor(o,r):t;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,o,r,t);else for(var n=e.length-1;n>=0;n--)(s=e[n])&&(a=(i<3?s(a):i>3?s(o,r,a):s(o,r))||a);return i>3&&a&&Object.defineProperty(o,r,a),a}function l(e,o){return function(r,t){o(r,t,e)}}function c(e,o,r,t,s,i){function a(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var n,l=t.kind,c="getter"===l?"get":"setter"===l?"set":"value",u=!o&&e?t.static?e:e.prototype:null,d=o||(u?Object.getOwnPropertyDescriptor(u,t.name):{}),p=!1,g=r.length-1;g>=0;g--){var h={};for(var f in t)h[f]="access"===f?{}:t[f];for(var f in t.access)h.access[f]=t.access[f];h.addInitializer=function(e){if(p)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(e||null))};var m=(0,r[g])("accessor"===l?{get:d.get,set:d.set}:d[c],h);if("accessor"===l){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(n=a(m.get))&&(d.get=n),(n=a(m.set))&&(d.set=n),(n=a(m.init))&&s.unshift(n)}else(n=a(m))&&("field"===l?s.unshift(n):d[c]=n)}u&&Object.defineProperty(u,t.name,d),p=!0}function u(e,o,r){for(var t=arguments.length>2,s=0;s<o.length;s++)r=t?o[s].call(e,r):o[s].call(e);return t?r:void 0}function d(e){return"symbol"==typeof e?e:"".concat(e)}function p(e,o,r){return"symbol"==typeof o&&(o=o.description?"[".concat(o.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",o):o})}function g(e,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,o)}function h(e,o,r,t){return new(r||(r=Promise))((function(s,i){function a(e){try{l(t.next(e))}catch(e){i(e)}}function n(e){try{l(t.throw(e))}catch(e){i(e)}}function l(e){var o;e.done?s(e.value):(o=e.value,o instanceof r?o:new r((function(e){e(o)}))).then(a,n)}l((t=t.apply(e,o||[])).next())}))}function f(e,o){var r,t,s,i,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function n(n){return function(l){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,n[0]&&(a=0)),a;)try{if(r=1,t&&(s=2&n[0]?t.return:n[0]?t.throw||((s=t.return)&&s.call(t),0):t.next)&&!(s=s.call(t,n[1])).done)return s;switch(t=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,t=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((s=(s=a.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){a.label=n[1];break}if(6===n[0]&&a.label<s[1]){a.label=s[1],s=n;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(n);break}s[2]&&a.ops.pop(),a.trys.pop();continue}n=o.call(e,a)}catch(e){n=[6,e],t=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,l])}}}var m=Object.create?function(e,o,r,t){void 0===t&&(t=r);var s=Object.getOwnPropertyDescriptor(o,r);s&&!("get"in s?!o.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return o[r]}}),Object.defineProperty(e,t,s)}:function(e,o,r,t){void 0===t&&(t=r),e[t]=o[r]};function w(e,o){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(o,r)||m(o,e,r)}function y(e){var o="function"==typeof Symbol&&Symbol.iterator,r=o&&e[o],t=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}};throw new TypeError(o?"Object is not iterable.":"Symbol.iterator is not defined.")}function C(e,o){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var t,s,i=r.call(e),a=[];try{for(;(void 0===o||o-- >0)&&!(t=i.next()).done;)a.push(t.value)}catch(e){s={error:e}}finally{try{t&&!t.done&&(r=i.return)&&r.call(i)}finally{if(s)throw s.error}}return a}function $(){for(var e=[],o=0;o<arguments.length;o++)e=e.concat(C(arguments[o]));return e}function b(){for(var e=0,o=0,r=arguments.length;o<r;o++)e+=arguments[o].length;var t=Array(e),s=0;for(o=0;o<r;o++)for(var i=arguments[o],a=0,n=i.length;a<n;a++,s++)t[s]=i[a];return t}function v(e,o,r){if(r||2===arguments.length)for(var t,s=0,i=o.length;s<i;s++)!t&&s in o||(t||(t=Array.prototype.slice.call(o,0,s)),t[s]=o[s]);return e.concat(t||Array.prototype.slice.call(o))}function F(e){return this instanceof F?(this.v=e,this):new F(e)}function k(e,o,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,s=r.apply(e,o||[]),i=[];return t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t;function a(e){s[e]&&(t[e]=function(o){return new Promise((function(r,t){i.push([e,o,r,t])>1||n(e,o)}))})}function n(e,o){try{(r=s[e](o)).value instanceof F?Promise.resolve(r.value.v).then(l,c):u(i[0][2],r)}catch(e){u(i[0][3],e)}var r}function l(e){n("next",e)}function c(e){n("throw",e)}function u(e,o){e(o),i.shift(),i.length&&n(i[0][0],i[0][1])}}function j(e){var o,r;return o={},t("next"),t("throw",(function(e){throw e})),t("return"),o[Symbol.iterator]=function(){return this},o;function t(t,s){o[t]=e[t]?function(o){return(r=!r)?{value:F(e[t](o)),done:!1}:s?s(o):o}:s}}function _(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=e[Symbol.asyncIterator];return r?r.call(e):(e=y(e),o={},t("next"),t("throw"),t("return"),o[Symbol.asyncIterator]=function(){return this},o);function t(r){o[r]=e[r]&&function(o){return new Promise((function(t,s){!function(e,o,r,t){Promise.resolve(t).then((function(o){e({value:o,done:r})}),o)}(t,s,(o=e[r](o)).done,o.value)}))}}}function O(e,o){return Object.defineProperty?Object.defineProperty(e,"raw",{value:o}):e.raw=o,e}var S=Object.create?function(e,o){Object.defineProperty(e,"default",{enumerable:!0,value:o})}:function(e,o){e.default=o};function P(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&m(o,e,r);return S(o,e),o}function M(e){return e&&e.__esModule?e:{default:e}}function E(e,o,r,t){if("a"===r&&!t)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof o?e!==o||!t:!o.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?t:"a"===r?t.call(e):t?t.value:o.get(e)}function z(e,o,r,t,s){if("m"===t)throw new TypeError("Private method is not writable");if("a"===t&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof o?e!==o||!s:!o.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===t?s.call(e,r):s?s.value=r:o.set(e,r),r}function D(e,o){if(null===o||"object"!=typeof o&&"function"!=typeof o)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?o===e:e.has(o)}function T(e,o,r){if(null!=o){if("object"!=typeof o&&"function"!=typeof o)throw new TypeError("Object expected.");var t;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");t=o[Symbol.asyncDispose]}if(void 0===t){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");t=o[Symbol.dispose]}if("function"!=typeof t)throw new TypeError("Object not disposable.");e.stack.push({value:o,dispose:t,async:r})}else r&&e.stack.push({async:!0});return o}var x="function"==typeof SuppressedError?SuppressedError:function(e,o,r){var t=new Error(r);return t.name="SuppressedError",t.error=e,t.suppressed=o,t};function B(e){function o(o){e.error=e.hasError?new x(o,e.error,"An error was suppressed during disposal."):o,e.hasError=!0}return function r(){for(;e.stack.length;){var t=e.stack.pop();try{var s=t.dispose&&t.dispose.call(t.value);if(t.async)return Promise.resolve(s).then(r,(function(e){return o(e),r()}))}catch(e){o(e)}}if(e.hasError)throw e.error}()}const N={__extends:s,__assign:i,__rest:a,__decorate:n,__param:l,__metadata:g,__awaiter:h,__generator:f,__createBinding:m,__exportStar:w,__values:y,__read:C,__spread:$,__spreadArrays:b,__spreadArray:v,__await:F,__asyncGenerator:k,__asyncDelegator:j,__asyncValues:_,__makeTemplateObject:O,__importStar:P,__importDefault:M,__classPrivateFieldGet:E,__classPrivateFieldSet:z,__classPrivateFieldIn:D,__addDisposableResource:T,__disposeResources:B}}},o={};function r(t){var s=o[t];if(void 0!==s)return s.exports;var i=o[t]={exports:{}};return e[t](i,i.exports,r),i.exports}r.d=(e,o)=>{for(var t in o)r.o(o,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},r.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(245).MRPack.run()})();
"use strict";exports.id=687,exports.ids=[687],exports.modules={718:(s,e,a)=>{var t;a.d(e,{e:()=>i}),function(s){s.DAY="d",s.HOUR="h",s.MINUTE="m",s.SECOND="s",s.MILLISECOND="ms"}(t||(t={}));class i{static MESES=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];static SEMANA=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];static generarFechaMySQL(s){return[s.getUTCFullYear(),`00${s.getUTCMonth()+1}`.slice(-2),`00${s.getUTCDate()}`.slice(-2)].join("-")}static generarFechaElastic(s,e={}){const a=[];return(e={anno:!0,mes:!0,dia:!0,...e}).anno&&a.push(`${s.getUTCFullYear()}`),e.mes&&a.push(`00${s.getUTCMonth()+1}`.slice(-2)),e.dia&&a.push(`00${s.getUTCDate()}`.slice(-2)),a.length>0?a.join("."):""}static generarFechaNatural(s){return[`00${s.getUTCDate()}`.slice(-2),`00${s.getUTCMonth()+1}`.slice(-2),s.getUTCFullYear()].join("/")}static generarFechaNaturalConDiaSemana(s){return`${i.SEMANA[s.getUTCDay()-1>=0?s.getUTCDay()-1:i.SEMANA.length-1]}, `+[`00${s.getUTCDate()}`.slice(-2),`00${s.getUTCMonth()+1}`.slice(-2),s.getUTCFullYear()].join("/")}static generarFechaBloque(s){return[s.getUTCFullYear(),`00${s.getUTCMonth()+1}`.slice(-2),`00${s.getUTCDate()}`.slice(-2)].join("")}static generarHora(s,e=!0){return[`00${s.getUTCHours()}`.slice(-2),`00${s.getUTCMinutes()}`.slice(-2),`00${s.getUTCSeconds()}`.slice(-2)].join(":")+(e?" UTC":"")}static generarHoraMinuto(s,e=!0){return[`00${s.getUTCHours()}`.slice(-2),`00${s.getUTCMinutes()}`.slice(-2)].join(":")+(e?" UTC":"")}static generarMarcaMinuto(s){return[s.getUTCFullYear(),`00${s.getUTCMonth()+1}`.slice(-2),`00${s.getUTCDate()}`.slice(-2),`00${s.getUTCHours()}`.slice(-2),`00${s.getUTCMinutes()}`.slice(-2)].join("")}static generarMarcaMes(s=new Date){return[s.getUTCFullYear(),`00${s.getUTCMonth()+1}`.slice(-2)].join("")}static generarVersion(s){return`${s.getUTCFullYear()}.${s.getUTCMonth()+1}.${s.getUTCDate()}-${s.getUTCHours()}${`00${s.getUTCMinutes()}`.slice(-2)}${`00${s.getUTCSeconds()}`.slice(-2)}`}static generarFechaHoraMySQL(s){return`${i.generarFechaMySQL(s)} ${i.generarHora(s,!1)}`}static generarFechaHoraNatural(s,e=!0){return`${i.generarFechaNatural(s)} ${i.generarHoraMinuto(s,e)}`}static generarFechaHoraNaturalConDiaSemana(s,e=!0){return`${i.generarFechaNaturalConDiaSemana(s)} ${i.generarHoraMinuto(s,e)}`}static generarIntervaloFechasNatural(s,e){return s.getDate()==e.getDate()&&s.getMonth()==e.getMonth()&&s.getFullYear()==e.getFullYear()?`${s.getDate()} ${this.MESES[s.getMonth()]}`:`${s.getDate()}${s.getMonth()!=e.getMonth()?` ${this.MESES[s.getMonth()]}`:""} - ${e.getDate()} ${this.MESES[e.getMonth()]}`}static generarDateDesdeMySQL(s){const e=s.split(/[- :]/).map((s=>parseInt(s)));return new Date(Date.UTC(e[0],e[1]-1,e[2],e[3]||0,e[4]||0,e[5]||0))}static ignoraTZ(s){return new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()))}static generarLog(){return`[${this.generarFechaHoraNatural(new Date,!1)}]`}static determineDiffTime(s){const e={time:s,unit:t.MILLISECOND};return s>864e5?(e.time=parseFloat((s/864e5).toFixed(2)),e.unit=t.DAY):s>36e5?(e.time=parseFloat((s/36e5).toFixed(2)),e.unit=t.HOUR):s>6e4?(e.time=parseFloat((s/6e4).toFixed(2)),e.unit=t.MINUTE):s>1e3&&(e.time=parseFloat((s/1e3).toFixed(2)),e.unit=t.SECOND),e}static getDate(s){return new Date((new Date).toLocaleString("en-US",{timeZone:s}))}}},203:(s,e,a)=>{a.d(e,{K:()=>l});var t=a(24),i=a(799),o=a(386);class r{defecto;codes;fallbacks;fallbacksDown;constructor(s){this.defecto=[],this.codes=[],this.fallbacks={},this.fallbacksDown={},this.init(s)}init(s){this.defecto=s[""]??[],this.fallbacksDown={},delete s[""],this.fallbacks=s;const e=Object.keys(s);for(const a of Object.keys(s)){const t=s[a];e.push(...t);for(const s of t)this.fallbacksDown[s]??=[a]}function a(s,e){const t=[],i=s[e];if(null==i)return[];for(const e of i)t.includes(e)||(t.push(e),t.push(...a(s,e)));return[...new Set(t)]}this.codes=[...new Set(e)].sort();for(const s of Object.keys(this.fallbacksDown))this.fallbacksDown[s]=a(this.fallbacksDown,s)}toJSON(){return{...this.fallbacks,"":this.defecto}}getFallbacksUP(s){return this.fallbacks[s]??this.defecto}getFallbacksDOWN(s){return this.fallbacksDown[s]??this.defecto}getKeys(){return Object.keys(this.fallbacks)}}var n=a(189);class l extends r{version;static async fromMySQL(){const s={};let e=new Date(0);for(const a of await n.A.query("SELECT * FROM `idiomas` ORDER BY `idioma`"))s[a.idioma]=a.fallbacks,e=e<a.version?a.version:e;return new this(s,e)}static fromJSON(s,e){return new this(s,e??new Date(0))}constructor(s,e){super(s),this.version=e}async reload(s){await(0,o.fo)(`${s}/idiomas.json`)?this.init(await(0,o.TQ)(`${s}/idiomas.json`)):console.error("No existe el archivo",i.J.colorize([i.J.FgRed],"idiomas.json"))}addWatch(s){(0,t.watch)(`${s}/idiomas.json`,(async(e,a)=>{console.log("Cambios en ",`${s}/idiomas.json`,a),this.reload(s).then((()=>{})).catch((()=>{}))}))}}},268:(s,e,a)=>{a.d(e,{n:()=>r});var t=a(598),i=a(386),o=a(203);class r{config;static limpiarId(s){return s.split(".").map((s=>s[0].toUpperCase()+s.substring(1))).join("").split("_").map((s=>s[0].toUpperCase()+s.substring(1))).join("").split("-").map((s=>s[0].toUpperCase()+s.substring(1))).join("")}id;padre;descripcion;idiomas;customIdiomas;version;hash;jerarquia;submodulos;values;base_id;cambio;className;constructor(s,e,a){this.config=a,this.id=s.id,this.padre=s.padre,this.descripcion=s.descripcion,null==s.idiomas?(this.idiomas=e,this.customIdiomas=void 0):(this.idiomas=o.K.fromJSON(s.idiomas),this.customIdiomas=this.idiomas),this.version=s.version,this.hash=s.hash,this.jerarquia=this.id.split("."),this.values={},this.submodulos=[],this.base_id=this.jerarquia.at(-1)??this.id,this.cambio=!1,this.className=r.limpiarId(this.id)}toJSON(){return{id:this.base_id,descripcion:this.descripcion,idiomas:this.customIdiomas?.toJSON(),version:this.version.toISOString(),hash:this.hash}}async load(){this.values=await this.loadValues(),this.submodulos=await this.loadSubmodulos()}async refreshHash(){const s={};for(const[e,a]of Object.entries(this.values))null!=a&&(s[e]=await a.refreshHash());const e={};for(const s of this.submodulos)e[s.base_id]=await s.refreshHash();const a=(0,t.createHash)("md5").update(JSON.stringify({id:this.id,padre:this.padre,descripcion:this.descripcion,idiomas:this.customIdiomas,traducciones:s,submodulos:e})).digest("hex");return a!=this.hash&&(this.version=new Date,this.hash=a,this.cambio=!0),this.hash}async write(s){await(0,i.Ck)(s,!0),await(0,i.TC)(`${s}/_metadata.json`,JSON.stringify(this.toJSON(),null,2),!0),await(0,i.TC)(`${s}/_values.json`,JSON.stringify(Object.values(this.values).map((s=>s?.toJSON())).filter((s=>null!=s)),null,2),!0)}}},330:(s,e,a)=>{a.d(e,{P:()=>v});var t=a(24),i=a(718),o=a(124),r=a(386),n=a(268),l=a(174),c=a(951),d=a(914),u=a(581),h=a(333),p=a(567),m=a(923);class f extends m.k{static async build(s,e,a){switch(a.tipo){case c.Pt.literal:return new d.G(s,e,{origen:a.origen,tipo:a.tipo,params:a.params,data:a.values,descripcion:a.descripcion,idiomas:a.idiomas,version:new Date(a.version),hash:a.hash});case c.Pt.plural:return new h.r(s,e,{origen:a.origen,tipo:a.tipo,params:a.params,data:a.values,descripcion:a.descripcion,idiomas:a.idiomas,version:new Date(a.version),hash:a.hash});case c.Pt.set:return new p.f(s,e,{origen:a.origen,tipo:a.tipo,params:a.params,data:a.values,descripcion:a.descripcion,idiomas:a.idiomas,version:new Date(a.version),hash:a.hash});case c.Pt.map:return new u.F(s,e,{origen:a.origen,tipo:a.tipo,params:a.params,data:a.values,descripcion:a.descripcion,idiomas:a.idiomas,version:new Date(a.version),hash:a.hash})}return Promise.reject(`Tipo de traduccion desconocido ${a.tipo} para la traduccion ${e} del modulo ${s.id}`)}static async loadAll(s,e){const a=await(0,r.TQ)(`${e}/${s.jerarquia.join("/")}/_values.json`),t=[];for(const e of a)null!=e.values&&t.push(this.build(s,e.id,{id:e.id,origen:e.origen??c.$n.auto,tipo:e.tipo??c.Pt.literal,params:e.params,values:e.values,descripcion:e.descripcion??"",idiomas:e.idiomas,version:new Date(e.version??0).toISOString(),hash:e.hash??""}));const i=await Promise.all(t),o={};for(const s of i)o[s.id]=s;return o}}var g=a(821);var $=a(189);class v extends n.n{static async load(s,e,a,t,i){const o=null!=i?`${s}/${i.jerarquia.join("/")}/${e}`:`${s}/${e}`;if(!await(0,r.Q7)(o))return Promise.reject(`No existe el modulo ${e}`);let n,l;return await(0,r.fo)(`${o}/_metadata.json`)?(n={...await(0,r.TQ)(`${o}/_metadata.json`),id:null!=i?`${i.id}.${e}`:e},l={jsondir:s,nuevo:!1,borrar:!1,padre:i,config:t}):(n={id:null!=i?`${i.id}.${e}`:e},l={jsondir:s,nuevo:!1,borrar:!0,padre:i,config:t}),this.build(n,a,l)}static async loadPadre(s,e,a,t){const i=`${s}/${e.jerarquia.join("/")}`;if(!await(0,r.Q7)(i))return Promise.reject(`No existe el modulo ${e.jerarquia.join("/")}`);const o=await(0,r.Ci)(i),n=[];for(const s of o)await(0,r.Q7)(`${i}/${s}`)&&n.push(s);return await Promise.all(n.map((i=>this.load(s,i,a,t,e))))}static async build(s,e,a){const t=new this({id:s.id,padre:a.padre?.id,descripcion:s.descripcion??"",idiomas:s.idiomas,version:new Date(s.version??0),hash:s.hash??""},e,a);return await t.load(),t}async loadValues(){return f.loadAll(this,this.config.jsondir)}async loadSubmodulos(){return v.loadPadre(this.config.jsondir,this,this.idiomas,this.config.config)}async preparePush(){const s=await l.P.load(this.id,this.config.config,this.idiomas).catch((()=>{}));if(null==s)this.config.nuevo=!0;else if(s.hash!=this.hash)return console.error(`El modulo ${o.J.colorize([o.J.FgYellow],this.id)} tiene una versión más reciente en mysql`),Promise.reject();for(const s of this.submodulos)await s.preparePush();await this.refreshHash()}quitarSubmodulo(s){const e=this.submodulos.indexOf(s);e>=0&&this.submodulos.splice(e,1)}async borrar(){for(const s of this.submodulos)await s.borrar();await $.A.update("UPDATE `modulos` SET `borrado`=1 WHERE `id`=?",[this.id]),await(0,r.y1)(`${this.config.jsondir}/${this.jerarquia.join("/")}`),this.config.padre?.quitarSubmodulo(this)}async toMySQL(){const s=null==this.customIdiomas?null:JSON.stringify(this.customIdiomas);if(this.config.borrar)return console.log(`Borrando el módulo ${o.J.colorize([o.J.FgRed],this.id)}`),void await this.borrar();if(this.cambio){if(this.config.nuevo)console.log(`Insertando el módulo ${o.J.colorize([o.J.FgGreen],this.id)}`),await $.A.insert("INSERT INTO `modulos` (`id`, `padre`, `descripcion`, `idiomas`, `version`, `hash`) VALUES (?, ?, ?, ?, ?, ?)",[this.id,this.config.padre?.id??null,this.descripcion,s,this.version,this.hash]),this.config.nuevo=!1;else{console.log(`Actualizando el módulo ${o.J.colorize([o.J.FgGreen],this.id)}`),await $.A.update("UPDATE `modulos` SET `descripcion`=?, `idiomas`=?, `version`=?, `hash`=? WHERE `id`=?",[this.descripcion,s,this.version,this.hash,this.id]);const e=Object.keys(this.values);e.length>0&&await $.A.update("UPDATE `traducciones` SET `borrado`=1 WHERE `modulo`=? AND `borrado`=0 AND `id` NOT IN (?)",[this.id,e]),this.submodulos.length>0&&await $.A.update("UPDATE `modulos` SET `borrado`=1 WHERE `padre`=? AND `borrado`=0 AND `id` NOT IN (?)",[this.id,this.submodulos.map((s=>s.id))])}this.cambio=!1;for(const s of Object.values(this.values))null!=s&&(await g.g.existe(this,s.id)||(s.nuevo=!0),await s.guardar());for(const s of this.submodulos)await s.toMySQL();await this.write(`${this.config.jsondir}/${this.jerarquia.join("/")}`)}else console.log(`Ignorando el módulo ${o.J.colorize([o.J.FgYellow],this.id)}`)}get submodulosFinales(){const s=this.config.config.modulos[this.id]?.include??[...this.submodulos.map((s=>s.base_id)),...Object.keys(this.values)],e=this.config.config.modulos[this.id]?.exclude??[],a=[];for(const t of this.submodulos)e.includes(t.base_id)||s.includes(t.base_id)&&a.push(t);return a}get valoresFinales(){const s=this.config.config.modulos[this.id]?.include??[...this.submodulos.map((s=>s.base_id)),...Object.keys(this.values)],e=this.config.config.modulos[this.id]?.exclude??[],a=[];for(const t of Object.keys(this.values))e.includes(t)||s.includes(t)&&a.push(this.values[t]);return a}async regenerar(s,e=[]){const a=this.submodulosFinales,t=this.valoresFinales,i=`${s}/${this.id.replaceAll("-","_").replaceAll(".","/")}`;await(0,r.Ck)(i,!0);const o={},n={};for(const s of this.config.config.langs){const e=this.calcularLang(s,a,t);o[e]??=[],o[e].push(s),s!=e&&(n[s]=e)}const l=[];for(const i of Object.keys(o))l.push(this.regenerarEjecutar(s,i,a,t,e));l.push((0,r.TC)(`${i}/index.ts`,(({id:s,jerarquia:e,className:a,valores:t,submodulos:i,lang:o,mapping:r})=>(t.sort(((s,e)=>s.className.localeCompare(e.className))),`// NO EDITAR A MANO\n${function(s,e,a){const t=[];for(const s of e)t.includes(s.tipo)||t.push(s.tipo);t.sort();const i=[];if(t.includes("map")&&i.push('import {ITraduccionMapKeys} from "services-comun/modules/traduccion/map";'),i.length>0&&i.push(""),a.length>0)for(const s of a){const e=s.base_id.replaceAll("-","_");i.push(`import type {${s.className}} from "./${e}";`)}return i.push(`import {checkClean} from "../${"../".repeat(s.length-1)}langs";`),i.length>0&&(i.push(""),i.push("")),i.join("\n")}(e,t,i)}${function(s){const e=[],a=[];for(const t of s)null!=t.params&&0!=t.params.length&&(e.push(`export type ${t.className}Param = "${t.params.toSorted().join('" | "')}";`),a.push(`export type ${t.className}Params = Record<${t.className}Param, string|number>;`));const t=[];return e.length>0&&(t.push(e.join("\n")),a.length>0&&t.push("")),a.length>0&&t.push(a.join("\n")),t.length>0&&(t.push(""),t.push("")),t.join("\n")}(t)}${function(s){const e=[];for(const a of s){if(null==a.keys)continue;const s=[];for(const e of a.keys)s.push(`    "${e}"?: string;`);const t=[];t.push(`export interface ${a.className}Record extends ITraduccionMapKeys {\n${s.join("\n")}\n}`),t.push(`export type ${a.className}Keys = keyof ${a.className}Record;`),e.push(t.join("\n")),e.push("")}return e.length>0&&e.push(""),e.join("\n")}(t)}${function(s,e,a){const t=[];for(const s of a){const e=s.base_id.replaceAll("-","_");t.push(`    ${e}: ${s.className};`)}for(const s of e){const e=s.id.replaceAll("-","_");switch(s.tipo){case c.Pt.literal:null==s.params||0==s.params.length?t.push(`    ${e}: string;`):t.push(`    ${e}: (params?: Partial<${s.className}Params>)=>string;`);break;case c.Pt.plural:case c.Pt.set:null==s.params||0==s.params.length?t.push(`    ${e}: (i: number)=>string;`):t.push(`    ${e}: (i: number, params?: Partial<${s.className}Params>)=>string;`);break;case c.Pt.map:null==s.params||0==s.params.length?t.push(`    ${e}: (key: ${s.className}Keys)=>string;`):t.push(`    ${e}: (key: ${s.className}Keys, params?: Partial<${s.className}Params>)=>string;`)}}return`export interface ${s} {\n${t.sort().join("\n")}\n}`}(a,t,i)}\n\nconst MAPPING: Record<string, string> = ${JSON.stringify(r,null,4)};\n\nexport default (lang: string, defecto${null!=o?"?":""}: string): Promise<${a}> => import(/* webpackChunkName: "i18n/[request]/${s}" */ \`i18n/.src/\${checkClean(lang, defecto, MAPPING)}/${s.replaceAll("-","_").replaceAll(".","/")}\`).then(module=> module.default);\n`))({id:this.id,jerarquia:this.jerarquia,className:this.className,valores:t,submodulos:a,lang:this.config.config.lang,mapping:n}),!0),(0,r.TC)(`${i}/bundle.ts`,(({id:s,jerarquia:e,className:a,lang:t,langs:i,mapping:o})=>`// NO EDITAR A MANO\n${function(s,e,a,t,i){const o=[];o.push(`import type {${a}} from ".";`),o.push(`import {check, type Langs} from "../${"../".repeat(e.length-1)}langs";`),o.sort(),o.push("");const r=[],n=[];for(const a of t){const t=null==i[a]?a.replace("-",""):i[a].replace("-","");n.includes(t)||(r.push(`import ${t} from "../${"../".repeat(e.length-1)}.src/${t}/${s.replaceAll("-","_").replaceAll(".","/")}";`),n.push(t))}return o.push(r.sort().join("\n")),o.join("\n")}(s,e,a,i,o)}\n\nconst langs: Record<Langs, ${a}> = {\n${i.map((s=>`    "${s}": ${null==o[s]?s.replace("-",""):o[s].replace("-","")},`)).join("\n")}\n};\n\nconst loader = (lang: string, defecto${null!=t?"?":""}: string): ${a} => langs[check(lang, defecto)];\n\nexport {${a}};\nexport default loader;\n`)({id:this.id,jerarquia:this.jerarquia,className:this.className,langs:this.config.config.langs,lang:this.config.config.lang,mapping:n}),!0));for(const s of Object.keys(o))e.includes(s)||e.push(s);e.sort();for(const t of a)l.push(t.regenerar(s,e).then((()=>{})));return await Promise.all(l),o}getJerarquiaIdiomas(s){const e=this.customIdiomas??this.idiomas,a=[s];return s.length>2?a.push(...new Set([...e.getFallbacksDOWN(s)])):a.push(...new Set([...e.getFallbacksUP(s),...e.getFallbacksDOWN(s)])),a}calcularLang(s,e=this.submodulosFinales,a=this.valoresFinales){const t=[];for(const e of a){const a=e.getIdioma(this.getJerarquiaIdiomas(s));null==a||t.includes(a)||t.push(a)}for(const a of e){const e=a.calcularLang(s);t.includes(e)||t.push(e)}switch(t.length){case 0:return"_";case 1:return t[0];default:return s}}async regenerarEjecutar(s,e,a,t,o){o.includes(e)||o.push(e);const n=(({id:s,jerarquia:e,version:a,hash:t,className:i,valores:o,submodulos:r})=>(o.sort(((s,e)=>s.className.localeCompare(e.className))),`// NO EDITAR A MANO\n${function(s,e,a,t,i){const o=[],r=[];for(const s of t)o.includes(s.tipo)||o.push(s.tipo),null!=s.keys&&r.push(`${s.className}Keys`),null!=s.params&&s.params.length>0&&r.push(`${s.className}Params`);o.sort();const n=[];if(0==r.length?n.push(`import type {${a} as Modulo} from "../../${"../".repeat(e.length)}${s.replaceAll("-","_").replaceAll(".","/")}";`):n.push(`import type {\n    ${a} as Modulo,\n    ${r.sort().join(",\n    ")}\n} from "../../${"../".repeat(e.length)}${s.replaceAll("-","_").replaceAll(".","/")}";`),i.length>0)for(const s of i){const a=s.id.replaceAll("-","_");n.push(`import type {${s.className}} from "../../${"../".repeat(e.length)}${a.replaceAll("-","_").replaceAll(".","/")}";`)}if(i.length>0){n.push("");for(const s of i){const e=s.base_id.replaceAll("-","_");n.push(`import ${e} from "./${e}";`)}}if(t.length>0){n.push("");for(const s of t){const e=s.id.replaceAll("-","_");n.push(`import ${e} from "./${e}";`)}}return n.join("\n")}(s,e,i,o,r)}\n\nclass ${i} implements Modulo {\n    /* STATIC */\n    // public static ID: string = "${s}";\n    // public static VERSION: string = "${a}";\n    // public static HASH: string = "${t}";\n\n    /* INSTANCE */${function(s,e){const a=[];for(const s of e){const e=s.base_id.replaceAll("-","_");a.push(`    public readonly ${e}: ${s.className};`)}const t=[];for(const e of s)if(e.tipo==c.Pt.literal&&(null==e.params||0==e.params.length)){const s=e.id.replaceAll("-","_");t.push(`    public readonly ${s}: string;`)}const i=[];return a.length>0&&(i.push(a.join("\n")),t.length>0&&i.push("")),t.length>0&&i.push(t.join("\n")),i.length>0&&(i.unshift(""),i.push("")),i.join("\n")}(o,r)}\n    public constructor() {\n${function(s,e){const a=[];for(const s of e){const e=s.base_id.replaceAll("-","_");a.push(`        this.${e} = ${e};`)}for(const e of s){const s=e.id.replaceAll("-","_");e.tipo!=c.Pt.literal||null!=e.params&&0!=e.params.length||a.push(`        this.${s} = ${s};`)}return a.sort().join("\n")}(o,r)}\n    }\n${function(s){const e=[];for(const a of s){if(a.tipo==c.Pt.literal&&(null==a.params||0==a.params.length))continue;const s=a.id.replaceAll("-","_");switch(a.tipo){case c.Pt.literal:e.push(`    public ${s}(params: Partial<${a.className}Params> = {}) { return ${s}.render(params); }`);break;case c.Pt.map:null==a.params||0==a.params.length?e.push(`    public ${s}(key: ${a.className}Keys) { return ${s}.render(key); }`):e.push(`    public ${s}(key: ${a.className}Keys, params: Partial<${a.className}Params> = {}) { return ${s}.render(key, params); }`);break;case c.Pt.plural:case c.Pt.set:null==a.params||0==a.params.length?e.push(`    public ${s}(i: number) { return ${s}.render(i); }`):e.push(`    public ${s}(i: number, params: Partial<${a.className}Params> = {}) { return ${s}.render(i, params); }`)}}return e.length>0&&e.unshift(""),e.join("\n")}(o)}\n}\n\nexport default new ${i}();\n`))({id:this.id,jerarquia:this.jerarquia,version:i.e.generarVersion(this.version),hash:this.hash,className:this.className,valores:t,submodulos:a}),l=[];for(const e of[...o]){const a=`${s}/.src/${e.replace("-","")}/${this.jerarquia.join("/").replaceAll("-","_")}`;await(0,r.Ck)(a,!0),l.push((0,r.TC)(`${a}/index.ts`,n,!0));const i=this.getJerarquiaIdiomas(e);for(const s of t)l.push(s.write(a,i))}await Promise.all(l);for(const s of t)s.clean()}addWatch(s){const e=`${this.config.jsondir}/${this.jerarquia.join("/")}`;(0,t.watch)(`${e}/_metadata.json`,(async(a,t)=>{console.log("Cambios en ",`${e}/_metadata.json`,t),this.regenerar(s).then((()=>{})).catch((()=>{}))})),(0,t.watch)(`${e}/_values.json`,(async(a,t)=>{console.log("Cambios en ",`${e}/_values.json`,t),this.regenerar(s).then((()=>{})).catch((()=>{}))}));for(const e of this.submodulos)e.addWatch(s)}}},174:(s,e,a)=>{a.d(e,{P:()=>d});var t=a(124),i=a(386),o=a(203),r=a(268),n=a(330),l=a(821),c=a(189);class d extends r.n{static async getIDS(){return(await c.A.query("SELECT `id` FROM `modulos` WHERE `padre` IS NULL AND borrado=0 ORDER BY id")).map((s=>s.id))}static async load(s,e,a){const[[t],i]=await Promise.all([c.A.query("SELECT * FROM `modulos` WHERE id=? AND borrado=0",[s]),null!=a?Promise.resolve(a):o.K.fromMySQL()]);return null==t?Promise.reject(`No existe el modulo ${s}`):await this.build(t,i,e)}static async loadPadre(s,e,a){const t=await c.A.query("SELECT * FROM `modulos` WHERE padre=? AND borrado=0 ORDER BY id",[s]);return await Promise.all(t.map((s=>this.build(s,e,a))))}static async build(s,e,a){const t=new this({id:s.id,padre:s.padre??void 0,descripcion:s.descripcion,idiomas:s.idiomas??void 0,version:s.version,hash:s.hash},e,{nuevo:!1,config:a});return await t.load(),t}async loadValues(){return l.g.loadAll(this)}async loadSubmodulos(){return d.loadPadre(this.id,this.idiomas,this.config.config)}async fixVersion(){if(this.cambio){console.log(`Corrigiendo hash y versión del módulo ${t.J.colorize([t.J.FgGreen,t.J.Bright],this.id)}`),await c.A.update("UPDATE `modulos` SET `version`=?, `hash`=? WHERE `id`=?",[this.version,this.hash,this.id]);for(const s of Object.values(this.values))await(s?.fixVersion());for(const s of this.submodulos)await s.fixVersion()}}async toFile(s,e,a){e.modulos[this.id]??={};const o=`${s}/i18n/.json`,r=await n.P.load(o,this.id,this.idiomas,this.config.config,a).catch((()=>{}));if(null!=r&&r.hash==this.hash)return void console.log("No es necesario actualizar",t.J.colorize([t.J.FgYellow,t.J.Bright],this.id));const l=`${o}/${this.jerarquia.join("/")}`;console.log("Descargando",t.J.colorize([t.J.FgGreen,t.J.Bright],this.id)),await this.write(l);const c=[...this.submodulos.map((s=>s.base_id)),"_metadata.json","_values.json"];for(const s of await(0,i.Ci)(l))c.includes(s)||(console.log("Borrando",t.J.colorize([t.J.FgYellow,t.J.Bright],`${l}/${s}`)),await(0,i.y1)(`${l}/${s}`));const d=await n.P.load(l,this.id,this.idiomas,this.config.config,a).catch((()=>{})),u=e.modulos[this.id].include,h=e.modulos[this.id].exclude??[];for(const a of this.submodulos)h.includes(a.base_id)||(null==u||u.includes(a.base_id))&&await a.toFile(s,e,d)}}},951:(s,e,a)=>{a.d(e,{$n:()=>i,Pt:()=>t,dz:()=>c});var t,i,o=a(598),r=a(386),n=a(203),l=a(189);!function(s){s.literal="literal",s.plural="plural",s.set="set",s.map="map"}(t||(t={})),function(s){s.auto="auto",s.interno="interno",s.externo="externo"}(i||(i={}));class c{modulo;id;original;nuevo;static limpiarId(s){return s.split(".").map((s=>s[0].toUpperCase()+s.substring(1))).join("").split("_").map((s=>s[0].toUpperCase()+s.substring(1))).join("").split("-").map((s=>s[0].toUpperCase()+s.substring(1))).join("")}origen;tipo;params;data;descripcion;idiomas;customIdiomas;version;hash;className;contenido;constructor(s,e,a,t=!1){this.modulo=s,this.id=e,this.original=a,this.nuevo=t,this.origen=a.origen,this.tipo=a.tipo,this.params=a.params,this.data=a.data,this.data.valor??={},this.descripcion=a.descripcion,null==a.idiomas?(this.idiomas=s.idiomas,this.customIdiomas=void 0):(this.idiomas=n.K.fromJSON(a.idiomas),this.customIdiomas=this.idiomas),this.version=a.version,this.hash=a.hash,this.className=`${this.modulo.className}${c.limpiarId(this.id)}`,this.contenido={}}toJSON(){return{id:this.id,descripcion:this.descripcion,origen:this.origen,tipo:this.tipo,params:this.params,values:this.data,idiomas:this.customIdiomas?.toJSON(),version:this.version.toISOString(),hash:this.hash}}async refreshHash(){const s=(0,o.createHash)("md5").update(JSON.stringify({origen:this.origen,tipo:this.tipo,params:this.params,values:this.data,descripcion:this.descripcion,idiomas:this.idiomas})).digest("hex");return s!=this.hash&&(this.version=new Date,this.hash=s),this.hash}async guardar(){const s=null==this.params?null:JSON.stringify(this.params),e=null==this.data?null:JSON.stringify(this.data),a=null==this.customIdiomas?null:JSON.stringify(this.customIdiomas);this.nuevo?(await l.A.insert("INSERT INTO `traducciones` (`modulo`, `id`, `origen`, `tipo`, `params`, `data`, `descripcion`, `idiomas`, `hash`, `version`) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE id=id",[this.modulo.id,this.id,this.origen,this.tipo,s,e,this.descripcion,a,this.hash,this.version]),this.nuevo=!1):await l.A.update("UPDATE `traducciones` SET `origen`=?, `tipo`=?, `params`=?, `data`=?, `descripcion`=?, `idiomas`=?, `hash`=?, `version`=? WHERE `modulo`=? AND `id`=?",[this.origen,this.tipo,s,e,this.descripcion,a,this.hash,this.version,this.modulo.id,this.id])}async fixVersion(){await l.A.update("UPDATE `traducciones` SET `hash`=?, `version`=? WHERE `modulo`=? AND `id`=?",[this.hash,this.version,this.modulo.id,this.id])}async write(s,e){const a=e.join(".");this.contenido[a]??=this.template(e).replaceAll("\\","\\\\"),await(0,r.TC)(`${s}/${this.id.replaceAll("-","_")}.ts`,this.contenido[a])}clean(){this.contenido={}}template(s){return null==this.params?this.templateNoParams(s):this.templateParams(s,this.params)}getIdioma(s){for(let e=0,a=s.length;e<a;e++)if(null!=this.data.valor[s[e]])return s[e]}}},914:(s,e,a)=>{a.d(e,{G:()=>i});var t=a(951);class i extends t.dz{constructor(s,e,a){super(s,e,a)}valores(s){for(const e of s)if(null!=this.data.valor[e])return this.data.valor[e];return this.data.defecto??this.id.toUpperCase()}templateNoParams(s){return(({id:s,modulo:e,valores:a})=>`// NO EDITAR A MANO\n// const id = "${e}.${s}";\nconst valor = \`${a}\`;\n\nexport default valor;\n`)({id:this.id,modulo:this.modulo.id,valores:this.valores(s)})}templateParams(s,e){return(({id:s,modulo:e,className:a,params:t,valores:i})=>`// NO EDITAR A MANO\nimport {TraduccionLiteral} from "services-comun/modules/traduccion/literal";\n\nimport type {${a}Params} from "../../${"../".repeat(e.split(".").length)}${e.replaceAll("-","_").replaceAll(".","/")}";\n\nconst id = "${e}.${s}";\nconst params: string[] = [${t.map((s=>`"${s}"`)).join(", ")}];\nconst valor = \`${i}\`;\n\nexport default new TraduccionLiteral<${a}Params>({\n    id,\n    params,\n}, valor);\n`)({id:this.id,modulo:this.modulo.id,className:this.className,params:e,valores:this.valores(s)})}}},923:(s,e,a)=>{a.d(e,{k:()=>t});class t{}},821:(s,e,a)=>{a.d(e,{g:()=>d});var t=a(951),i=a(914),o=a(923),r=a(581),n=a(333),l=a(567),c=a(189);class d extends o.k{static async build(s,e,a){if(null==a.data)return Promise.reject(`No hay datos para la traduccion ${e} del modulo ${s.id}`);switch(a.tipo){case t.Pt.literal:return new i.G(s,e,{origen:a.origen,tipo:a.tipo,params:a.params??void 0,data:a.data,descripcion:a.descripcion,idiomas:a.idiomas??void 0,version:a.version,hash:a.hash});case t.Pt.plural:return new n.r(s,e,{origen:a.origen,tipo:a.tipo,params:a.params??void 0,data:a.data,descripcion:a.descripcion,idiomas:a.idiomas??void 0,version:a.version,hash:a.hash});case t.Pt.set:return new l.f(s,e,{origen:a.origen,tipo:a.tipo,params:a.params??void 0,data:a.data,descripcion:a.descripcion,idiomas:a.idiomas??void 0,version:a.version,hash:a.hash});case t.Pt.map:return new r.F(s,e,{origen:a.origen,tipo:a.tipo,params:a.params??void 0,data:a.data,descripcion:a.descripcion,idiomas:a.idiomas??void 0,version:a.version,hash:a.hash})}return Promise.reject(`Tipo de traduccion desconocido ${a.tipo} para la traduccion ${e} del modulo ${s.id}`)}static async existe(s,e){const[a]=await c.A.query("SELECT `id` FROM `traducciones` WHERE `modulo`=? AND `id`=? AND `borrado`=0",[s.id,e]);return null!=a}static async loadAll(s){const e=await c.A.query("SELECT `id`, `origen`, `tipo`, `params`, `data`, `descripcion`, `idiomas`, `version`, `hash` FROM `traducciones` WHERE `modulo`=? AND `borrado`=0",[s.id]),a=[];for(const t of e)a.push(this.build(s,t.id,t));const t=await Promise.all(a),i={};for(const s of t)i[s.id]=s;return i}}},581:(s,e,a)=>{a.d(e,{F:()=>i});var t=a(951);class i extends t.dz{keys;constructor(s,e,a,t=!1){super(s,e,a,t),this.keys=[];for(const s of Object.values(this.data.valor??{}))this.keys.push(...Object.keys(s.valores).filter((s=>!this.keys.includes(s))).map((s=>s)));this.keys.push(...Object.keys(this.data.defecto?.valores??{}).filter((s=>!this.keys.includes(s))).map((s=>s)))}valores(s){const e={valores:{},defecto:this.defecto(s)};for(const a of this.keys){const t=this.valor(a,s);null!=t&&(e.valores[a]=t)}return e}valor(s,e){for(const a of e){const e=this.data.valor[a];if(null!=e){if(null!=e.valores[s])return e.valores[s];if(null!=e.defecto)return e.defecto}if(null!=this.data.defecto&&null!=this.data.defecto.valores[s])return this.data.defecto.valores[s]}}defecto(s){for(const e of s){const s=this.data.valor[e];if(null!=s?.defecto)return s.defecto}}templateNoParams(s){const[e,a]=this.parseValores(s);return(({id:s,modulo:e,className:a,valores:t,defecto:i})=>`// NO EDITAR A MANO\nimport {ITraduccionMapValores, TraduccionMap} from "services-comun/modules/traduccion/map";\n\nimport type {${a}Record} from "../../${"../".repeat(e.split(".").length)}${e.replaceAll("-","_").replaceAll(".","/")}";\n\nconst id = "${e}.${s}";\nconst valor: ITraduccionMapValores<${a}Record> = ${t};${null==i?"":`\nconst defecto = \`${i}\`;`}\n\nexport default new TraduccionMap<${a}Record>({\n    id,\n}, valor${null==i?"":", defecto"});\n`)({id:this.id,modulo:this.modulo.id,className:this.className,keys:this.keys,valores:e,defecto:a})}templateParams(s,e){const[a,t]=this.parseValores(s);return(({id:s,modulo:e,className:a,params:t,valores:i,defecto:o})=>`// NO EDITAR A MANO\nimport {ITraduccionMapValores, TraduccionMap} from "services-comun/modules/traduccion/map";\n\nimport type {${a}Record, ${a}Params} from "../../${"../".repeat(e.split(".").length)}${e.replaceAll("-","_").replaceAll(".","/")}";\n\nconst id = "${e}.${s}";\nconst params: string[] = [${t.map((s=>`"${s}"`)).join(", ")}];\nconst valor: ITraduccionMapValores<${a}Record> = ${i};${null==o?"":`\nconst defecto = \`${o}\`;`}\n\nexport default new TraduccionMap<${a}Record, ${a}Params>({\n    id,\n    params,\n}, valor${null==o?"":", defecto"});\n`)({id:this.id,modulo:this.modulo.id,className:this.className,keys:this.keys,params:e,valores:a,defecto:t})}parseValores(s){const e=[],a=this.valores(s);let t=a.defecto;for(const s of this.keys){const i=a.valores[s];null!=i?e.push(`    "${s}": \`${i}\``):null==t&&(t=`${this.modulo.id}.${this.id}`.toUpperCase())}return e.length>0?[`{\n${e.join(",\n")},\n}`,t]:["{}",t]}}},333:(s,e,a)=>{a.d(e,{r:()=>i});var t=a(951);class i extends t.dz{herencia;herenciaClass;constructor(s,e,a){super(s,e,a),this.herencia="plural",this.herenciaClass="Plural"}valores(s){for(const e of s)if(null!=this.data.valor[e])return this.data.valor[e];return this.data.defecto??{"":this.id.toUpperCase()}}templateNoParams(s){const[e,a]=this.parseValores(s);return(({id:s,modulo:e,defecto:a,valores:t})=>`// NO EDITAR A MANO\nimport {TraduccionPlural} from "services-comun/modules/traduccion/plural";\n\nconst id = "${e}.${s}";\nconst defecto = \`${a}\`;\nconst valores: Record<number, string> = ${t};\n\nexport default new TraduccionPlural({\n    id,\n}, defecto, valores);\n`)({id:this.id,modulo:this.modulo.id,defecto:a,valores:e})}templateParams(s,e){const[a,t]=this.parseValores(s);return(({id:s,modulo:e,className:a,params:t,defecto:i,valores:o})=>`// NO EDITAR A MANO\nimport {TraduccionPlural} from "services-comun/modules/traduccion/plural";\n\nimport type {${a}Params} from "../../${"../".repeat(e.split(".").length)}${e.replaceAll("-","_").replaceAll(".","/")}";\n\nconst id = "${e}.${s}";\nconst params: string[] = [${t.map((s=>`"${s}"`)).join(", ")}];\nconst defecto = \`${i}\`;\nconst valores: Record<number, string> = ${o};\n\nexport default new TraduccionPlural<${a}Params>({\n    id,\n    params,\n}, defecto, valores);\n`)({id:this.id,modulo:this.modulo.id,className:this.className,params:e,defecto:t,valores:a})}parseValores(s){const e=[],a=this.valores(s);let t=a[""];for(const s of Object.keys(a).filter((s=>""!=s))){const t=a[s];e.push(`    ${s}: \`${t}\``)}return e.length>0?[`{\n${e.join(",\n")},\n}`,t]:["{}",t]}}},567:(s,e,a)=>{a.d(e,{f:()=>i});var t=a(951);class i extends t.dz{herencia;herenciaClass;constructor(s,e,a){super(s,e,a),this.herencia="set",this.herenciaClass="Set"}valores(s){for(const e of s)if(null!=this.data.valor[e])return this.data.valor[e];return this.data.defecto??{valores:[]}}templateNoParams(s){const[e,a]=this.parseValores(s);return(({id:s,modulo:e,valores:a,defecto:t})=>`// NO EDITAR A MANO\nimport {TraduccionSet, type TValor} from "services-comun/modules/traduccion/set";\n\nconst id = "${e}.${s}";\nconst valores: TValor[] = ${a};${null!=t?`\nconst defecto = \`${t}\`;`:""}\n\nexport default new TraduccionSet({\n    id,\n}, valores${null!=t?", defecto":""});\n`)({id:this.id,modulo:this.modulo.id,valores:e,defecto:a})}templateParams(s,e){const[a,t]=this.parseValores(s);return(({id:s,modulo:e,className:a,params:t,valores:i,defecto:o})=>`// NO EDITAR A MANO\nimport {TraduccionSet, type TValor} from "services-comun/modules/traduccion/set";\n\nimport type {${a}Params} from "../../${"../".repeat(e.split(".").length)}${e.replaceAll("-","_").replaceAll(".","/")}";\n\nconst id = "${e}.${s}";\nconst params: string[] = [${t.map((s=>`"${s}"`)).join(", ")}];\nconst valores: TValor[] = ${i};${null!=o?`\nconst defecto = \`${o}\`;`:""}\n\nexport default new TraduccionSet<${a}Params>({\n    id,\n    params,\n}, valores${null!=o?", defecto":""});\n`)({id:this.id,modulo:this.modulo.id,className:this.className,params:e,valores:a,defecto:t})}parseValores(s){const e=[],a=this.valores(s),t=a.defecto;for(const s of a.valores??[])null!=s?e.push(`    \`${s}\``):e.push("    undefined");return e.length>0?[`[\n${e.join(",\n")},\n]`,t]:["[]",t]}}}};
//# sourceMappingURL=687.js.map
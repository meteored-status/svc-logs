"use strict";exports.id=582,exports.ids=[582],exports.modules={386:(t,e,n)=>{n.d(e,{Q7:()=>h,fo:()=>f,Em:()=>F,Ck:()=>y,Ci:()=>i.readdir,pA:()=>p,Cj:()=>w,TQ:()=>g,$w:()=>J,Nr:()=>m,TC:()=>$,y1:()=>v});var o=n(24),r=n.n(o),a=n(760),s=n.n(a),i=n(455),c=n(229),l=n(763),u=n(75);(0,n(975).promisify)(u.pipeline);var d=n(416);async function p(t){return(0,i.readFile)(t)}async function w(t){return(await(0,i.readFile)(t)).toString("utf-8")}async function g(t){try{const e=await w(t);return JSON.parse(e)}catch(t){return Promise.reject(t)}}async function h(t,e=!1){try{if((await(0,i.stat)(t)).isDirectory())return!0}catch(t){}return!!e&&Promise.reject("Not a directory")}async function f(t,e=!1){try{if((await(0,i.stat)(t)).isFile())return!0}catch(t){}return!!e&&Promise.reject("Not a file")}async function y(t,e=!1){await(0,i.mkdir)(t,{recursive:e})}async function J(t,e){return(0,i.rename)(t,e).then((()=>!0)).catch((()=>!1))}async function m(t){await(0,i.rm)(t,{recursive:!0,force:!0})}async function $(t,e,n=!1,o=!1){const a=`${t}.${(0,d.y)()}`;return new Promise(((s,i)=>{r().writeFile(a,e,{flag:"wx"},(e=>{e?o?i("No se pudo escribir archivo temporal"):((0,c.z3)("Error en safeWrite",a,e),s(!1)):async function(t,e,n){return!n&&await async function(t){return new Promise((e=>{r().access(t,r().constants.F_OK,(t=>{e(!t)}))}))}(e)?(await v(t),!1):(await J(t,e)||await v(t),!0)}(a,t,n).then((t=>{t?s(!0):o?i("No se pudo renombrar el archivo temporal al final"):s(!1)}))}))}))}async function v(t){await f(t)?await new Promise(((e,n)=>{r().unlink(t,(t=>{t?n(t):e()}))})):await h(t)&&await m(t)}async function F(t){if(!await f(t)&&!await h(t))return"";const e=await async function(t){const e=[(0,l.F)(s().basename(t))];if(await f(t))e.push((0,l.F)(await w(t)));else if(await h(t))for(const n of await(0,i.readdir)(t)){const o=`${t}/${n}`;await h(o)?"files"!=o&&e.push(await F(o)):await f(o)&&(e.push((0,l.F)(n)),e.push((0,l.F)(await w(o))))}return e.join("")}(t);return 32!=e.length?(0,l.F)(e):e}},763:(t,e,n)=>{n.d(e,{F:()=>r});var o=n(598);function r(t){return(0,o.createHash)("md5").update(t).digest("hex")}},229:(t,e,n)=>{n.d(e,{$e:()=>u,pq:()=>l,z3:()=>d});var o=n(161),r=n.n(o),a=n(139),s=n.n(a);const i="true"==process.env.KUBERNETES,c=function(){const t=s().worker?.id;if(i){const e=r().hostname().split("-"),n=e.pop();return e.pop(),null==t?`[${e.join("-")} ${n}]`:`[${e.join("-")} ${n} {${t}}]`}return null==t?"":` {${t}}`}();function l(...t){t.length>0?console.info(c,...t):i||console.info("")}function u(...t){t.length>0?console.warn(c,...t):i||console.warn("")}function d(...t){t.length>0?console.error(c,...t):i||console.error("")}},416:(t,e,n)=>{n.d(e,{y:()=>r});const o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";function r(t=8){let e="";for(let n=0;n<t;n++)e+=o.charAt(Math.round(62*Math.random()));return e}},765:(t,e,n)=>{n.d(e,{O:()=>r});var o=n(421);class r{static async spawn(t,e=[],{cwd:n,env:r={},shell:a=!0,colores:s=!0}={}){const i=(0,o.spawn)(t,e,{cwd:n,env:{...process.env,...r,...s?{FORCE_COLOR:"1"}:{}},stdio:"pipe",shell:a}),c=[];i.stdout.on("data",(t=>{c.push(t.toString("utf-8"))}));const l=[];return i.stderr.on("data",(t=>{l.push(t.toString("utf-8"))})),new Promise((t=>{i.on("close",(e=>{t({status:e??0,stdout:c.join(""),stderr:l.join("")})}))}))}}},582:(t,e,n)=>{n.d(e,{R:()=>i});var o=n(421),r=n(124),a=n(765),s=n(386);class i{static async update(t,e){console.log(r.J.colorize([r.J.FgCyan,r.J.Bright],"Actualizando YARN")),console.group();const{anterior:n,nueva:o}=await this.updateBase(t),a=n!=o,i=a||e;a&&(await(0,s.TC)(`${t}/${n}`,await(0,s.pA)(`${t}/${o}`)),r.J.resetNext()),console.groupEnd(),i&&await this.install(t,{verbose:!1});const c=await(0,s.Cj)(`${t}/yarn.lock`),l=await this.upgrade(t),u=await(0,s.Cj)(`${t}/yarn.lock`);0!=l||!a&&c==u||await this.install(t,{verbose:!1}),a&&await(0,s.y1)(`${t}/${n}`)}static async getPath(t){const e=await(0,s.Cj)(`${t}/.yarnrc.yml`);return e.split("yarnPath:").at(1)?.trim()??"0.0.0"}static async updateBase(t){console.log(r.J.colorize([r.J.FgWhite],"Versión de Yarn")),console.group();const e=await this.getPath(t),{status:n,stderr:o}=await a.O.spawn("yarn",["set","version","latest"],{cwd:t});if(0!=n)return console.error(r.J.colorize([r.J.FgRed,r.J.Bright],"ERROR")),console.error(o),console.groupEnd(),Promise.reject();const s=await this.getPath(t),i=s.split("/").at(-1)?.split("-").at(-1)?.split(".").slice(0,3).join(".")??"0.0.0";return e!=s?console.log(`${r.J.colorize([r.J.FgGreen],i)} (Nueva versión)`):console.log(`${r.J.colorize([r.J.FgBlue],i)} (Sin cambios)`),console.groupEnd(),{anterior:e,nueva:s}}static async install(t,{verbose:e,install:n=!0,optimize:o=!0}={}){if(e??=!0,console.log(r.J.colorize([r.J.FgCyan,r.J.Bright],"Reinstalando dependencias")),console.group(),n){const{status:n,stdout:o,stderr:s}=await a.O.spawn("yarn",["install"],{cwd:t});if(0!=n)return console.error(`[${r.J.colorize([r.J.FgRed,r.J.Bright],"ERROR")}]`),console.log(s),console.groupEnd(),Promise.reject();e&&console.log(o)}if(o){console.log("Optimizando dependencias");const{status:n,stdout:o}=await a.O.spawn("yarn",["dedupe","--strategy","highest"],{cwd:t});0==n?console.error(`[${r.J.colorize([r.J.FgGreen,r.J.Bright],"OK   ")}]`):console.error(`[${r.J.colorize([r.J.FgRed,r.J.Bright],"ERROR")}]`),e&&console.log(o)}console.groupEnd()}static async upgrade(t){return console.log(r.J.colorize([r.J.FgCyan,r.J.Bright],"Actualizando dependencias")),console.group(),new Promise((e=>{(0,o.spawn)("yarn",["upgrade-interactive"],{cwd:t,shell:!0,stdio:[process.stdin,process.stdout,process.stderr]}).on("error",(t=>{console.error("Error actualizando dependencias",t)})).on("close",(t=>{console.groupEnd(),e(t??0)}))}))}}}};
//# sourceMappingURL=582.js.map
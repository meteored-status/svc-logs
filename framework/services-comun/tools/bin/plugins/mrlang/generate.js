"use strict";exports.id=168,exports.ids=[168],exports.modules={15:(n,e,o)=>{o.d(e,{Generate:()=>u});var s=o(386),l=o(203),a=o(330);const t=({lang:n,langs:e})=>{const[o,s]=e.reduce(((n,e)=>[Math.max(n[0],e.length),Math.min(n[1],e.length)]),[0,1/0]);return`// NO EDITAR A MANO\nexport type Langs = "${e.join('" | "')}";\n\nexport const SOPORTADOS: string[] = ["${e.join('", "')}"];\n\nexport function check(lang: string, defecto: string${null!=n?` = "${n}"`:""}, mapping: Record<string, string> = {}): Langs {\n    if (SOPORTADOS.indexOf(lang)<0) {\n        ${2==s&&o>2?"if (lang.length>2) {\n        lang = lang.substring(0, 2);\n        if (SOPORTADOS.indexOf(lang)<0) {\n            lang = defecto;\n        }\n    } else {\n        lang = defecto;\n    }":"lang = defecto;"}\n    }\n    if (mapping[lang]!=undefined) {\n        lang = mapping[lang];\n    }\n\n    return lang as Langs;\n}\n\nexport const checkClean = (lang: string, defecto${null!=n?"?":""}: string, mapping: Record<string, string> = {}): string => check(lang, defecto, mapping).replace("-", "");\n`},r=({modulos:n,lang:e,mapping:o})=>(n.sort(((n,e)=>n.className.localeCompare(e.className))),`// NO EDITAR A MANO\n${function(n){const e=[];for(const o of n){const n=o.id.replaceAll("-","_");e.push(`import type {${o.className}} from "./${n}";`)}return e.join("\n")}(n)}\nimport {checkClean} from "./langs";\n\nexport interface ModuloLoader {${function(n){const e=[];for(const o of n){const n=o.id.replaceAll("-","_");e.push(`    ${n}: Promise<${o.className}>;`)}return e.length>0&&e.unshift(""),e.join("\n")}(n)}\n}\n\nconst MAPPING: Record<string, string> = ${JSON.stringify(o,null,4)};\n\nexport default (lang: string, defecto${null!=e?"?":""}: string): Promise<ModuloLoader> => import(/* webpackChunkName: "i18n/[request]" */ \`i18n/.src/\${checkClean(lang, defecto, MAPPING)}/\`).then(module=> module.default);\n`),c=({modulos:n,lang:e,langs:o,mapping:s})=>(n.sort(((n,e)=>n.className.localeCompare(e.className))),o.sort(),`// NO EDITAR A MANO\n${function(n,e,o){const s=[];s.push('import {check, type Langs} from "./langs";');for(const n of e){const e=n.id.replaceAll("-","_");s.push(`import type {${n.className}} from "./${e}";`)}s.sort(),s.push("");const l=[],a=[];for(const e of n){const n=null==o[e]?e.replace("-",""):o[e].replace("-","");a.includes(n)||(l.push(`import ${n} from "./.src/${n}/bundle";`),a.push(n))}return s.push(l.toSorted().join("\n")),s.join("\n")}(o,n,s)}\n\nexport interface ModuloLoader {\n${function(n){const e=[];for(const o of n){const n=o.id.replaceAll("-","_");e.push(`    ${n}: ${o.className};`)}return e.join("\n")}(n)}\n}\n\nconst langs: Record<Langs, ModuloLoader> = {\n${o.map((n=>`    "${n}": ${null==s[n]?n.replace("-",""):s[n].replace("-","")},`)).join("\n")}\n};\n\nexport default (lang: string, defecto${null!=e?"?":""}: string): ModuloLoader => langs[check(lang, defecto)];\n`),i=({lang:n,modulos:e,langs:o})=>(e.sort(((n,e)=>n.className.localeCompare(e.className))),`// NO EDITAR A MANO\nimport type {ModuloLoader} from "../..";${function(n){const e=[];for(const o of n){const n=o.id.replaceAll("-","_");e.push(`import type {${o.className}} from "../../${n}";`)}return e.length>0&&e.unshift(""),e.join("\n")}(e)}\n\nclass Modulo implements ModuloLoader {\n    /* INSTANCE */${function(n,e,o){const s=n;n=n.replace("-","");const l=[];for(const a of e){const e=a.id.replaceAll("-","_").replaceAll(".","/");let t=!1;for(const n of Object.keys(o[a.id]))if(o[a.id][n].includes(s)||"_"==n){l.push(`    public get ${e}(): Promise<${a.className}> { return import(/* webpackChunkName: "i18n/${n}/${a.id.replace("-","_").replace(".","/")}" */ "i18n/.src/${n.replace("-","")}/${e}").then(module=> module.default); }`),t=!0;break}t||l.push(`    public get ${e}(): Promise<${a.className}> { return import(/* webpackChunkName: "i18n/${n}/${a.id.replace("-","_").replace(".","/")}" */ "i18n/.src/${n}/${e}").then(module=> module.default); }`)}return l.length>0&&(l.unshift(""),l.push("")),l.join("\n")}(n,e,o)}\n    public constructor() {\n    }\n}\n\nexport default new Modulo();\n`),p=({lang:n,modulos:e,langs:o})=>(e.sort(((n,e)=>n.className.localeCompare(e.className))),`// NO EDITAR A MANO\nimport type {ModuloLoader} from "../../bundle";${function(n,e,o){const s=[];for(const n of e){const e=n.id.replaceAll("-","_");s.push(`import type {${n.className}} from "../../${e}";`)}if(s.length>0){s.sort(),s.unshift(""),s.push("");const l=n;n=n.replace("-","");for(const a of e){const e=a.id.replaceAll("-","_").replaceAll(".","/");let t=!1;for(const n of Object.keys(o[a.id]))if(o[a.id][n].includes(l)||"_"==n){s.push(`import ${e} from "i18n/.src/${n.replace("-","")}/${e}";`),t=!0;break}t||s.push(`import ${e} from "i18n/.src/${n}/${e}";`)}}return s.join("\n")}(n,e,o)}\n\nclass Modulo implements ModuloLoader {\n    /* INSTANCE */\n${e.map((n=>`    public readonly ${n.base_id.replaceAll("-","_")}: ${n.className};`)).join("\n")}\n\n    public constructor() {\n${e.map((n=>`        this.${n.base_id.replaceAll("-","_")} = ${n.base_id.replaceAll("-","_")};`)).join("\n")}\n    }\n}\n\nexport default new Modulo();\n`);class u{static async run(n,e){const{config:o}=await(0,s.TQ)(`${n}/i18n/package.json`),u=`${n}/i18n/.json`,d=`${n}/i18n`;if(!await(0,s.Q7)(u))return console.error("No existe el directorio",u),Promise.reject();if(!await(0,s.fo)(`${u}/idiomas.json`))return Promise.reject("No hay archivo de idiomas");await(0,s.Q7)(`${d}/.src`)&&await(0,s.Nr)(`${d}/.src`);const g=[".credenciales",".json",".run","package.json","tsconfig.json"];for(const n of await(0,s.Ci)(d))g.includes(n)||await(0,s.Nr)(`${d}/${n}`);await(0,s.Ck)(`${d}/.src`,!0);const f=Object.keys(o.modulos).filter((n=>!n.includes("."))),m=l.K.fromJSON(await(0,s.TQ)(`${u}/idiomas.json`));null==o.lang||o.langs.includes(o.lang)||o.langs.push(o.lang),o.langs.sort();const $=await Promise.all(f.map((n=>a.P.load(u,n,m,o)))),h={};for(const n of $)h[n.id]=await n.regenerar(d);const N=this.generarMapping(h,$.length),A=[(0,s.TC)(`${d}/langs.ts`,t({lang:o.lang,langs:o.langs}),!0),(0,s.TC)(`${d}/index.ts`,r({modulos:$,lang:o.lang,mapping:N}),!0),(0,s.TC)(`${d}/bundle.ts`,c({modulos:$,lang:o.lang,langs:o.langs,mapping:N}),!0)],O=[];for(const n of o.langs){const e=null==N[n]?n:N[n];O.includes(e)||A.push((0,s.TC)(`${d}/.src/${e.replace("-","")}/index.ts`,i({lang:e,modulos:$,langs:h}),!0),(0,s.TC)(`${d}/.src/${e.replace("-","")}/bundle.ts`,p({lang:e,modulos:$,langs:h}),!0))}if(await Promise.all(A),e){m.addWatch(u);for(const n of $)n.addWatch(d)}}static generarMapping(n,e){const o={};for(const e of Object.keys(n))for(const s of Object.keys(n[e]))if(!n[e][s].includes(s))for(const l of n[e][s])o[l]??={lang:s,modulos:[]},o[l].modulos.push(e);const s={};for(const n of Object.keys(o))o[n].modulos.length==e&&(s[n]=o[n].lang);return s}}}};
//# sourceMappingURL=generate.js.map
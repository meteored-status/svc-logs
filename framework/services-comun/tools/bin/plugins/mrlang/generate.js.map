{"version":3,"file":"plugins/mrlang/generate.js","mappings":"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","sources":["webpack://services-comun/./tools/src/mrlang/clases/modulo/tmpl/langs.ts","webpack://services-comun/./tools/src/mrlang/clases/modulo/tmpl/loader.ts","webpack://services-comun/./tools/src/mrlang/clases/modulo/tmpl/loader-bundle.ts","webpack://services-comun/./tools/src/mrlang/clases/modulo/tmpl/loader-lang.ts","webpack://services-comun/./tools/src/mrlang/clases/modulo/tmpl/loader-lang-bundle.ts","webpack://services-comun/./tools/src/mrlang/clases/generate.ts"],"sourcesContent":["function checkSimple() {\n    return `lang = defecto;`;\n}\nfunction checkAmpliado() {\n    return `if (lang.length>2) {\n        lang = lang.substring(0, 2);\n        if (SOPORTADOS.indexOf(lang)<0) {\n            lang = defecto;\n        }\n    } else {\n        lang = defecto;\n    }`;\n}\nexport default ({ lang, langs }) => {\n    const [max, min] = langs.reduce((a, b) => [Math.max(a[0], b.length), Math.min(a[1], b.length)], [0, Infinity]);\n    return `// NO EDITAR A MANO\nexport type Langs = \"${langs.join('\" | \"')}\";\n\nexport const SOPORTADOS: string[] = [\"${langs.join('\", \"')}\"];\n\nexport function check(lang: string, defecto: string${lang != undefined ? ` = \"${lang}\"` : \"\"}, mapping: Record<string, string> = {}): Langs {\n    if (SOPORTADOS.indexOf(lang)<0) {\n        ${min == 2 && max > 2 ? checkAmpliado() : checkSimple()}\n    }\n    if (mapping[lang]!=undefined) {\n        lang = mapping[lang];\n    }\n\n    return lang as Langs;\n}\n\nexport const checkClean = (lang: string, defecto${lang != undefined ? \"?\" : \"\"}: string, mapping: Record<string, string> = {}): string => check(lang, defecto, mapping).replace(\"-\", \"\");\n`;\n};\n","function getImports(modulos) {\n    const imports = [];\n    for (const modulo of modulos) {\n        const id = modulo.id.replaceAll(\"-\", \"_\");\n        imports.push(`import type {${modulo.className}} from \"./${id}\";`);\n    }\n    return imports.join(\"\\n\");\n}\nfunction getInterfaces(modulos) {\n    const imports = [];\n    for (const modulo of modulos) {\n        const id = modulo.id.replaceAll(\"-\", \"_\");\n        imports.push(`    ${id}: Promise<${modulo.className}>;`);\n    }\n    if (imports.length > 0) {\n        imports.unshift(\"\");\n    }\n    return imports.join(\"\\n\");\n}\nexport default ({ modulos, lang, mapping }) => {\n    modulos.sort((a, b) => a.className.localeCompare(b.className));\n    return `// NO EDITAR A MANO\n${getImports(modulos)}\nimport {checkClean} from \"./langs\";\n\nexport interface ModuloLoader {${getInterfaces(modulos)}\n}\n\nconst MAPPING: Record<string, string> = ${JSON.stringify(mapping, null, 4)};\n\nexport default (lang: string, defecto${lang != undefined ? \"?\" : \"\"}: string): Promise<ModuloLoader> => import(/* webpackChunkName: \"i18n/[request]\" */ \\`i18n/.src/$\\{checkClean(lang, defecto, MAPPING)}/\\`).then(module=> module.default);\n`;\n};\n","function getImports(langs, modulos, mapping) {\n    const imports = [];\n    imports.push(`import {check, type Langs} from \"./langs\";`);\n    for (const modulo of modulos) {\n        const id = modulo.id.replaceAll(\"-\", \"_\");\n        imports.push(`import type {${modulo.className}} from \"./${id}\";`);\n    }\n    imports.sort();\n    imports.push(\"\");\n    const imports2 = [];\n    const importados = [];\n    for (const lang of langs) {\n        const id = mapping[lang] == undefined ?\n            lang.replace(\"-\", \"\") :\n            mapping[lang].replace(\"-\", \"\");\n        if (importados.includes(id)) {\n            continue;\n        }\n        imports2.push(`import ${id} from \"./.src/${id}/bundle\";`);\n        importados.push(id);\n    }\n    imports.push(imports2.toSorted().join(\"\\n\"));\n    return imports.join(\"\\n\");\n}\nfunction getInterfaces(modulos) {\n    const imports = [];\n    for (const modulo of modulos) {\n        const id = modulo.id.replaceAll(\"-\", \"_\");\n        imports.push(`    ${id}: ${modulo.className};`);\n    }\n    return imports.join(\"\\n\");\n}\nexport default ({ modulos, lang, langs, mapping }) => {\n    modulos.sort((a, b) => a.className.localeCompare(b.className));\n    langs.sort();\n    return `// NO EDITAR A MANO\n${getImports(langs, modulos, mapping)}\n\nexport interface ModuloLoader {\n${getInterfaces(modulos)}\n}\n\nconst langs: Record<Langs, ModuloLoader> = {\n${langs.map(lang => `    \"${lang}\": ${mapping[lang] == undefined ? lang.replace(\"-\", \"\") : mapping[lang].replace(\"-\", \"\")},`).join(\"\\n\")}\n};\n\nexport default (lang: string, defecto${lang != undefined ? \"?\" : \"\"}: string): ModuloLoader => langs[check(lang, defecto)];\n`;\n};\n","function getImports(modulos) {\n    const imports = [];\n    for (const modulo of modulos) {\n        const id = modulo.id.replaceAll(\"-\", \"_\");\n        imports.push(`import type {${modulo.className}} from \"../../${id}\";`);\n    }\n    if (imports.length > 0) {\n        imports.unshift(\"\");\n    }\n    return imports.join(\"\\n\");\n}\nfunction getGetters(lang, modulos, langs) {\n    const original = lang;\n    lang = lang.replace(\"-\", \"\");\n    const getters = [];\n    for (const modulo of modulos) {\n        const id = modulo.id.replaceAll(\"-\", \"_\").replaceAll(\".\", \"/\");\n        let ok = false;\n        for (const key of Object.keys(langs[modulo.id])) {\n            if (langs[modulo.id][key].includes(original) || key == \"_\") {\n                getters.push(`    public get ${id}(): Promise<${modulo.className}> { return import(/* webpackChunkName: \"i18n/${key}/${modulo.id.replace(\"-\", \"_\").replace(\".\", \"/\")}\" */ \"i18n/.src/${key.replace(\"-\", \"\")}/${id}\").then(module=> module.default); }`);\n                ok = true;\n                break;\n            }\n        }\n        if (!ok) {\n            getters.push(`    public get ${id}(): Promise<${modulo.className}> { return import(/* webpackChunkName: \"i18n/${lang}/${modulo.id.replace(\"-\", \"_\").replace(\".\", \"/\")}\" */ \"i18n/.src/${lang}/${id}\").then(module=> module.default); }`);\n        }\n    }\n    if (getters.length > 0) {\n        getters.unshift(\"\");\n        getters.push(\"\");\n    }\n    return getters.join(\"\\n\");\n}\nexport default ({ lang, modulos, langs }) => {\n    modulos.sort((a, b) => a.className.localeCompare(b.className));\n    return `// NO EDITAR A MANO\nimport type {ModuloLoader} from \"../..\";${getImports(modulos)}\n\nclass Modulo implements ModuloLoader {\n    /* INSTANCE */${getGetters(lang, modulos, langs)}\n    public constructor() {\n    }\n}\n\nexport default new Modulo();\n`;\n};\n","function getImports(lang, modulos, langs) {\n    const imports = [];\n    for (const modulo of modulos) {\n        const id = modulo.id.replaceAll(\"-\", \"_\");\n        imports.push(`import type {${modulo.className}} from \"../../${id}\";`);\n    }\n    if (imports.length > 0) {\n        imports.sort();\n        imports.unshift(\"\");\n        imports.push(\"\");\n        const original = lang;\n        lang = lang.replace(\"-\", \"\");\n        for (const modulo of modulos) {\n            const id = modulo.id.replaceAll(\"-\", \"_\").replaceAll(\".\", \"/\");\n            let ok = false;\n            for (const key of Object.keys(langs[modulo.id])) {\n                // console.log(key, original, langs[modulo.id][key]);\n                if (langs[modulo.id][key].includes(original) || key == \"_\") {\n                    imports.push(`import ${id} from \"i18n/.src/${key.replace(\"-\", \"\")}/${id}\";`);\n                    ok = true;\n                    break;\n                }\n            }\n            if (!ok) {\n                imports.push(`import ${id} from \"i18n/.src/${lang}/${id}\";`);\n            }\n        }\n    }\n    return imports.join(\"\\n\");\n}\nexport default ({ lang, modulos, langs }) => {\n    modulos.sort((a, b) => a.className.localeCompare(b.className));\n    return `// NO EDITAR A MANO\nimport type {ModuloLoader} from \"../../bundle\";${getImports(lang, modulos, langs)}\n\nclass Modulo implements ModuloLoader {\n    /* INSTANCE */\n${modulos.map(modulo => `    public readonly ${modulo.base_id.replaceAll(\"-\", \"_\")}: ${modulo.className};`).join(\"\\n\")}\n\n    public constructor() {\n${modulos.map(modulo => `        this.${modulo.base_id.replaceAll(\"-\", \"_\")} = ${modulo.base_id.replaceAll(\"-\", \"_\")};`).join(\"\\n\")}\n    }\n}\n\nexport default new Modulo();\n`;\n};\n","import { isDir, isFile, mkdir, readDir, readJSON, rmdir, safeWrite } from \"services-comun/modules/utiles/fs\";\nimport { IdiomasLoader } from \"./idioma/loader\";\nimport { ModuloJSON } from \"./modulo/json\";\nimport loaderLangs from \"./modulo/tmpl/langs\";\nimport loader from \"./modulo/tmpl/loader\";\nimport loaderBundle from \"./modulo/tmpl/loader-bundle\";\nimport loaderLangTMPL from \"./modulo/tmpl/loader-lang\";\nimport loaderLangBundleTMPL from \"./modulo/tmpl/loader-lang-bundle\";\nexport class Generate {\n    /* STATIC */\n    static async run(basedir, watch) {\n        const { config } = await readJSON(`${basedir}/i18n/package.json`);\n        const jsondir = `${basedir}/i18n/.json`;\n        const classdir = `${basedir}/i18n`;\n        if (!await isDir(jsondir)) {\n            console.error(\"No existe el directorio\", jsondir);\n            return Promise.reject();\n        }\n        if (!await isFile(`${jsondir}/idiomas.json`)) {\n            return Promise.reject(\"No hay archivo de idiomas\");\n        }\n        //aquí limpiamos los archivos generados anteriormente\n        if (await isDir(`${classdir}/.src`)) {\n            await rmdir(`${classdir}/.src`);\n        }\n        const validas = [\".credenciales\", \".json\", \".run\", \"package.json\", \"tsconfig.json\"];\n        for (const file of await readDir(classdir)) {\n            if (!validas.includes(file)) {\n                await rmdir(`${classdir}/${file}`);\n            }\n        }\n        await mkdir(`${classdir}/.src`, true);\n        const moduloIDs = Object.keys(config.modulos).filter(id => !id.includes(\".\"));\n        const idiomas = IdiomasLoader.fromJSON(await readJSON(`${jsondir}/idiomas.json`));\n        if (config.lang != undefined && !config.langs.includes(config.lang)) {\n            config.langs.push(config.lang);\n        }\n        config.langs.sort();\n        const modulos = await Promise.all(moduloIDs.map(id => ModuloJSON.load(jsondir, id, idiomas, config)));\n        //loaderLangs\n        const langs = {};\n        for (const modulo of modulos) {\n            langs[modulo.id] = await modulo.regenerar(classdir);\n        }\n        const mapping = this.generarMapping(langs, modulos.length);\n        const promesas = [\n            safeWrite(`${classdir}/langs.ts`, loaderLangs({ lang: config.lang, langs: config.langs }), true),\n            safeWrite(`${classdir}/index.ts`, loader({ modulos, lang: config.lang, mapping }), true),\n            safeWrite(`${classdir}/bundle.ts`, loaderBundle({ modulos, lang: config.lang, langs: config.langs, mapping }), true),\n        ];\n        const procesados = [];\n        for (const lang of config.langs) {\n            const idioma = mapping[lang] == undefined ? lang : mapping[lang];\n            if (procesados.includes(idioma)) {\n                continue;\n            }\n            promesas.push(safeWrite(`${classdir}/.src/${idioma.replace(\"-\", \"\")}/index.ts`, loaderLangTMPL({ lang: idioma, modulos, langs }), true), safeWrite(`${classdir}/.src/${idioma.replace(\"-\", \"\")}/bundle.ts`, loaderLangBundleTMPL({ lang: idioma, modulos, langs }), true));\n        }\n        await Promise.all(promesas);\n        if (watch) {\n            idiomas.addWatch(jsondir);\n            for (const modulo of modulos) {\n                modulo.addWatch(classdir);\n            }\n        }\n    }\n    static generarMapping(modulos, cantidad) {\n        const cantidades = {};\n        for (const modulo of Object.keys(modulos)) {\n            for (const lang of Object.keys(modulos[modulo])) {\n                if (!modulos[modulo][lang].includes(lang)) {\n                    for (const idioma of modulos[modulo][lang]) {\n                        cantidades[idioma] ??= {\n                            lang,\n                            modulos: [],\n                        };\n                        cantidades[idioma].modulos.push(modulo);\n                    }\n                }\n            }\n        }\n        const mapping = {};\n        for (const lang of Object.keys(cantidades)) {\n            if (cantidades[lang].modulos.length == cantidad) {\n                mapping[lang] = cantidades[lang].lang;\n            }\n        }\n        return mapping;\n    }\n}\n"],"names":["lang","langs","max","min","reduce","a","b","Math","length","Infinity","join","undefined","modulos","mapping","sort","className","localeCompare","imports","modulo","id","replaceAll","push","getImports","unshift","getInterfaces","JSON","stringify","imports2","importados","replace","includes","toSorted","map","original","getters","ok","key","Object","keys","getGetters","base_id","Generate","run","basedir","watch","config","jsondir","classdir","console","error","Promise","reject","validas","file","moduloIDs","filter","idiomas","fromJSON","all","load","regenerar","this","generarMapping","promesas","procesados","idioma","addWatch","cantidad","cantidades"],"sourceRoot":""}
"use strict";exports.id=232,exports.ids=[232],exports.modules={169:(e,t,i)=>{var a=i(317),r=a.spawn,o=a.exec;function n(e,t,i){var a={};try{Object.keys(e).forEach((function(i){e[i].forEach((function(e){a[e]||(l(e,t),a[e]=1)})),a[i]||(l(i,t),a[i]=1)}))}catch(e){if(i)return i(e);throw e}if(i)return i()}function l(e,t){try{process.kill(parseInt(e,10),t)}catch(e){if("ESRCH"!==e.code)throw e}}function s(e,t,i,a,r){var o=a(e),n="";o.stdout.on("data",(function(e){e=e.toString("ascii"),n+=e})),o.on("close",(function(o){delete i[e],0==o?n.match(/\d+/g).forEach((function(o){o=parseInt(o,10),t[e].push(o),t[o]=[],i[o]=1,s(o,t,i,a,r)})):0==Object.keys(i).length&&r()}))}e.exports=function(e,t,i){if("function"==typeof t&&void 0===i&&(i=t,t=void 0),e=parseInt(e),Number.isNaN(e)){if(i)return i(new Error("pid must be a number"));throw new Error("pid must be a number")}var a={},l={};switch(a[e]=[],l[e]=1,process.platform){case"win32":o("taskkill /pid "+e+" /T /F",i);break;case"darwin":s(e,a,l,(function(e){return r("pgrep",["-P",e])}),(function(){n(a,t,i)}));break;default:s(e,a,l,(function(e){return r("ps",["-o","pid","--no-headers","--ppid",e])}),(function(){n(a,t,i)}))}}},718:(e,t,i)=>{var a;i.d(t,{e:()=>r}),function(e){e.DAY="d",e.HOUR="h",e.MINUTE="m",e.SECOND="s",e.MILLISECOND="ms"}(a||(a={}));class r{static MESES=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];static SEMANA=["Lunes","Martes","Miércoles","Jueves","Viernes","Sábado","Domingo"];static generarFechaMySQL(e){return[e.getUTCFullYear(),`00${e.getUTCMonth()+1}`.slice(-2),`00${e.getUTCDate()}`.slice(-2)].join("-")}static generarFechaElastic(e,t={}){const i=[];return(t={anno:!0,mes:!0,dia:!0,...t}).anno&&i.push(`${e.getUTCFullYear()}`),t.mes&&i.push(`00${e.getUTCMonth()+1}`.slice(-2)),t.dia&&i.push(`00${e.getUTCDate()}`.slice(-2)),i.length>0?i.join("."):""}static generarFechaNatural(e){return[`00${e.getUTCDate()}`.slice(-2),`00${e.getUTCMonth()+1}`.slice(-2),e.getUTCFullYear()].join("/")}static generarFechaNaturalConDiaSemana(e){return`${r.SEMANA[e.getUTCDay()-1>=0?e.getUTCDay()-1:r.SEMANA.length-1]}, `+[`00${e.getUTCDate()}`.slice(-2),`00${e.getUTCMonth()+1}`.slice(-2),e.getUTCFullYear()].join("/")}static generarFechaBloque(e){return[e.getUTCFullYear(),`00${e.getUTCMonth()+1}`.slice(-2),`00${e.getUTCDate()}`.slice(-2)].join("")}static generarHora(e,t=!0){return[`00${e.getUTCHours()}`.slice(-2),`00${e.getUTCMinutes()}`.slice(-2),`00${e.getUTCSeconds()}`.slice(-2)].join(":")+(t?" UTC":"")}static generarHoraMinuto(e,t=!0){return[`00${e.getUTCHours()}`.slice(-2),`00${e.getUTCMinutes()}`.slice(-2)].join(":")+(t?" UTC":"")}static generarMarcaMinuto(e){return[e.getUTCFullYear(),`00${e.getUTCMonth()+1}`.slice(-2),`00${e.getUTCDate()}`.slice(-2),`00${e.getUTCHours()}`.slice(-2),`00${e.getUTCMinutes()}`.slice(-2)].join("")}static generarMarcaMes(e=new Date){return[e.getUTCFullYear(),`00${e.getUTCMonth()+1}`.slice(-2)].join("")}static generarVersion(e){return`${e.getUTCFullYear()}.${e.getUTCMonth()+1}.${e.getUTCDate()}-${e.getUTCHours()}${`00${e.getUTCMinutes()}`.slice(-2)}${`00${e.getUTCSeconds()}`.slice(-2)}`}static generarFechaHoraMySQL(e){return`${r.generarFechaMySQL(e)} ${r.generarHora(e,!1)}`}static generarFechaHoraNatural(e,t=!0){return`${r.generarFechaNatural(e)} ${r.generarHoraMinuto(e,t)}`}static generarFechaHoraNaturalConDiaSemana(e,t=!0){return`${r.generarFechaNaturalConDiaSemana(e)} ${r.generarHoraMinuto(e,t)}`}static generarIntervaloFechasNatural(e,t){return e.getDate()==t.getDate()&&e.getMonth()==t.getMonth()&&e.getFullYear()==t.getFullYear()?`${e.getDate()} ${this.MESES[e.getMonth()]}`:`${e.getDate()}${e.getMonth()!=t.getMonth()?` ${this.MESES[e.getMonth()]}`:""} - ${t.getDate()} ${this.MESES[t.getMonth()]}`}static generarDateDesdeMySQL(e){const t=e.split(/[- :]/).map((e=>parseInt(e)));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3]||0,t[4]||0,t[5]||0))}static ignoraTZ(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))}static generarLog(){return`[${this.generarFechaHoraNatural(new Date,!1)}]`}static determineDiffTime(e){const t={time:e,unit:a.MILLISECOND};return e>864e5?(t.time=parseFloat((e/864e5).toFixed(2)),t.unit=a.DAY):e>36e5?(t.time=parseFloat((e/36e5).toFixed(2)),t.unit=a.HOUR):e>6e4?(t.time=parseFloat((e/6e4).toFixed(2)),t.unit=a.MINUTE):e>1e3&&(t.time=parseFloat((e/1e3).toFixed(2)),t.unit=a.SECOND),t}static getDate(e){return new Date((new Date).toLocaleString("en-US",{timeZone:e}))}}},372:(e,t,i)=>{i.d(t,{t:()=>o});var a=i(718),r=i(124);class o{static label_base=`${r.J.colorize([r.J.FgYellow,r.J.Underscore],"ENTORNO")} `;static label_compilar=`${r.J.colorize([r.J.FgGreen,r.J.Underscore],"GENERAR")} `;static label_ejecutar=`${r.J.colorize([r.J.FgCyan,r.J.Underscore],"EJECUTAR")}`;static generarFechaLog(e){return`[${a.e.generarHora(new Date,!1)}][${e.type}][${e.label}]`}static info(e,...t){t.length>0&&console.info(this.generarFechaLog(e),...t)}static error(e,...t){t.length>0&&console.error(this.generarFechaLog(e),...t)}}},627:(e,t,i)=>{i.d(t,{a:()=>n});var a=i(24),r=i(161),o=i.n(r);class n{nombre;root;dir;hijos;iniciado;watcher;constructor(e){this.nombre=e.nombre,this.root=e.root,this.dir=null!=e.path?`${e.root}/${e.path}/${e.nombre}`:`${e.root}/${e.nombre}`,this.hijos=[],this.iniciado=!1}addHijo(e){this.hijos.push(e)}async init(){this.iniciado||(this.iniciado=!0,await this.run(),this.initWatcher())}parar(){this.watcher?.close()}initWatcher(){this.parar(),"linux"!=o().platform()&&(this.watcher=(0,a.watch)(this.dir,{recursive:!0},((e,t)=>{t?.endsWith("~")||this.cambio()})))}cambio(){for(const e of this.hijos)e.cambio()}async run(){}}},851:(e,t,i)=>{i.d(t,{U3:()=>r,kl:()=>b,uK:()=>a});var a,r,o=i(421),n=i(24),l=i(161),s=i.n(l),c=i(169),h=i.n(c),u=i(124),p=i(627),d=i(386),g=i(372);!function(e){e.node="node",e.browser="browser",e.cfworker="cfworker",e.php="php"}(a||(a={})),function(e){e.meteored="meteored",e.nextjs="nextjs"}(r||(r={}));class b extends p.a{static TIMEOUT=3e5;static COMPILABLES=[a.node,a.browser,a.cfworker];static PAUSABLES=[r.meteored];compilar;ejecutar;label;global_compilar;global_ejecutar;config;compilador;ejecucion;timeout;constructor(e){super(e);const t=e.nombre.padEnd(e.pad),i=u.J.nextColor();this.compilar=e.compilar||e.forzar,this.ejecutar=e.ejecutar,this.label=u.J.colorize(i,t),this.global_compilar=!e.global.packd.disabled.includes(this.nombre),this.global_ejecutar=!e.global.devel.disabled.includes(this.nombre),this.config=(0,d.TQ)(`${this.dir}/package.json`).then((e=>e.config??{}))}initWatcher(){this.watcher?.close(),"linux"!=s().platform()?this.watcher=(0,n.watch)(this.dir,{recursive:!0},((e,t)=>{t?.endsWith("~")||("package.json"==t&&this.updatePackageFile(),this.cambio())})):this.watcher=(0,n.watch)(`${this.dir}/package.json`,(()=>{this.updatePackageFile()}))}cambio(){this.runCompilar().then((()=>{})).catch((e=>{g.t.error({type:g.t.label_base,label:this.label},"Error reiniciando el compilador",e)}));for(const e of this.hijos)e.cambio()}setTimeoutCompilador(){"linux"!=s().platform()&&(null!=this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.stopCompilar().then((()=>{})).catch((e=>{g.t.error({type:g.t.label_base,label:this.label},"Error pausando el compilador",e)}))}),b.TIMEOUT))}updatePackageFile(){this.config=(0,d.TQ)(`${this.dir}/package.json`).then((e=>e.config??{})),this.run().then((()=>{})).catch((e=>{g.t.error({type:g.t.label_base,label:this.label},"Error aplicando configuración específica",e)}))}updateGlobal(e){this.global_compilar=!e.packd.disabled.includes(this.nombre),this.global_ejecutar=!e.devel.disabled.includes(this.nombre),this.run().then((()=>{})).catch((e=>{g.t.error({type:g.t.label_base,label:this.label},"Error aplicando configuración global",e)}))}async run(){await super.run(),await Promise.all([this.runCompilar(),this.runEjecutar()])}async runCompilar(){await this.checkCompilar()?await this.initCompilar():await this.stopCompilar()}async runEjecutar(){await this.checkEjecucion()?await this.initEjecutar():await this.stopEjecutar()}async checkCompilar(){return!!this.compilar&&(!!this.global_compilar&&(!!(await this.config).generar||(null==this.compilador&&g.t.info({type:g.t.label_compilar,label:this.label},`Omitiendo workspace "${this.nombre}"`),!1)))}async initCompilar(){const e=await this.config;if(!b.COMPILABLES.includes(e.runtime))return;if(b.PAUSABLES.includes(e.framework)&&this.setTimeoutCompilador(),null!=this.compilador)return;let t;switch(e.framework){case r.nextjs:t="dev";break;case r.meteored:default:t="packd"}g.t.info({type:g.t.label_compilar,label:this.label},"Iniciando compilador"),this.compilador=(0,o.spawn)("yarn",["run",this.nombre,"run",t],{cwd:this.root,env:{...process.env,FORCE_COLOR:"1"},stdio:"pipe",shell:!0}),this.compilador.stdout.on("data",(e=>{const t=e.toString().split("\n").map((e=>e.trim())).filter((e=>e.length>0));for(const e of t)g.t.info({type:g.t.label_compilar,label:this.label},e)})),this.compilador.stderr.on("data",(e=>{const t=e.toString().split("\n").map((e=>e.trim())).filter((e=>e.length>0));for(const e of t)g.t.error({type:g.t.label_compilar,label:this.label},e)})),this.compilador.on("error",(e=>{g.t.error({type:g.t.label_compilar,label:this.label},u.J.colorize([u.J.FgRed,u.J.Bright],"Error de compilador"),e)}))}async stopCompilar(){return new Promise(((e,t)=>{null!=this.compilador?(g.t.info({type:g.t.label_compilar,label:this.label},"Deteniendo compilador (",this.compilador.pid,")"),null!=this.compilador.pid?h()(this.compilador.pid,(i=>{i?(g.t.error({type:g.t.label_compilar,label:this.label},"Deteniendo compilador => KO",i),t(i)):(g.t.info({type:g.t.label_compilar,label:this.label},"Deteniendo compilador => OK"),this.compilador=void 0,e())})):e()):e()}))}async checkEjecucion(){const e=await this.config;return!(!this.ejecutar||[a.browser,a.cfworker].includes(e.runtime)||[r.nextjs].includes(e.framework)||!this.global_ejecutar||!e.devel&&(null==this.ejecucion&&g.t.info({type:g.t.label_ejecutar,label:this.label},`Omitiendo workspace "${this.nombre}"`),1))}async initEjecutar(){if(null!=this.ejecucion)return;g.t.info({type:g.t.label_ejecutar,label:this.label},"Iniciando ejecución");const e=await this.config;this.ejecucion=(0,o.spawn)("yarn",["run",this.nombre,"run","devel"],{cwd:this.root,env:{...process.env,FORCE_COLOR:"1"},stdio:"pipe",shell:!0}),this.ejecucion.stdout.on("data",(e=>{const t=e.toString().split("\n").filter((e=>e.length>0));for(const e of t)g.t.info({type:g.t.label_ejecutar,label:this.label},e)})),this.ejecucion.stderr.on("data",(e=>{const t=e.toString().split("\n").filter((e=>e.length>0));for(const e of t)g.t.error({type:g.t.label_ejecutar,label:this.label},e)})),this.ejecucion.on("error",(e=>{g.t.error({type:g.t.label_ejecutar,label:this.label},u.J.colorize([u.J.FgRed,u.J.Bright],"Error de ejecución"),e)})),this.ejecucion.on("close",(t=>{0!=(t=t??0)?(g.t.error({type:g.t.label_ejecutar,label:this.label},"Terminado (",t,") Programando nueva ejecución en 30 segundos"),setTimeout((()=>{this.runEjecutar().then((()=>{})).catch((e=>{g.t.error({type:g.t.label_ejecutar,label:this.label},"Error en reinicio",e)}))}),3e4)):e.cronjob&&(g.t.info({type:g.t.label_ejecutar,label:this.label},"Terminado: Programando nueva ejecución en 10 minutos"),this.ejecucion=void 0,setTimeout((()=>{this.runEjecutar().then((()=>{})).catch((e=>{g.t.error({type:g.t.label_ejecutar,label:this.label},"Error en inicio programado",e)}))}),6e5))}))}async stopEjecutar(){return new Promise(((e,t)=>{null!=this.ejecucion?(g.t.info({type:g.t.label_ejecutar,label:this.label},"Deteniendo ejecución (",this.ejecucion.pid,")"),null!=this.ejecucion.pid?h()(this.ejecucion.pid,(i=>{i?(g.t.error({type:g.t.label_ejecutar,label:this.label},"Deteniendo ejecución => KO",i),t(i)):(g.t.info({type:g.t.label_ejecutar,label:this.label},"Deteniendo ejecución => OK"),this.ejecucion=void 0,e())})):e()):e()}))}}}};
//# sourceMappingURL=232.js.map